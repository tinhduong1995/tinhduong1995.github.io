<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quáº£n lÃ½ doanh thu quÃ¡n</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: #f8f9fa; }
    .menu-item-card { cursor: pointer; }
  </style>
</head>
<body>
<div class="container py-4">
  <h2 class="text-center mb-4">ğŸ“Š Quáº£n lÃ½ doanh thu quÃ¡n</h2>

  <!-- Thá»‘ng kÃª -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-center">
        <div class="card-body">
          <h5>Doanh thu hÃ´m nay</h5>
          <h3 id="totalRevenue">0 Ä‘</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center">
        <div class="card-body">
          <h5>Sá»‘ Ä‘Æ¡n hÃ ng</h5>
          <h3 id="totalOrders">0</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center">
        <div class="card-body">
          <h5>MÃ³n bÃ¡n cháº¡y</h5>
          <h3 id="bestSeller">ChÆ°a cÃ³</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Menu -->
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h4>ğŸ“– Menu</h4>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMenuItemModal">+ ThÃªm mÃ³n</button>
  </div>
  <div class="row" id="menuItemsContainer"></div>

  <!-- ÄÆ¡n hÃ ng -->
  <div class="d-flex justify-content-between align-items-center mt-4 mb-2">
    <h4>ğŸ§¾ ÄÆ¡n hÃ ng</h4>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#newOrderModal">+ Táº¡o Ä‘Æ¡n má»›i</button>
  </div>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>#</th>
        <th>NgÃ y</th>
        <th>Chi tiáº¿t</th>
        <th>Tá»•ng tiá»n</th>
      </tr>
    </thead>
    <tbody id="ordersTable"></tbody>
  </table>

  <!-- Biá»ƒu Ä‘á»“ -->
  <h4 class="mt-4">ğŸ“ˆ Biá»ƒu Ä‘á»“ doanh thu</h4>
  <canvas id="revenueChart" height="100"></canvas>
</div>

<!-- Modal thÃªm / sá»­a mÃ³n -->
<div class="modal fade" id="addMenuItemModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">ThÃªm mÃ³n má»›i</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">TÃªn mÃ³n</label>
          <input type="text" id="itemName" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">GiÃ¡</label>
          <input type="number" id="itemPrice" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Danh má»¥c</label>
          <select id="itemCategory" class="form-select">
            <option value="TrÃ ">TrÃ </option>
            <option value="TrÃ  sá»¯a">TrÃ  sá»¯a</option>
            <option value="Sinh tá»‘">Sinh tá»‘</option>
            <option value="Äá»“ Äƒn váº·t">Äá»“ Äƒn váº·t</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Há»§y</button>
        <button class="btn btn-primary" id="saveMenuItem">LÆ°u</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal táº¡o Ä‘Æ¡n -->
<div class="modal fade" id="newOrderModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Táº¡o Ä‘Æ¡n hÃ ng má»›i</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <label class="form-label">Chá»n mÃ³n</label>
            <select id="menuSelect" class="form-select"></select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Sá»‘ lÆ°á»£ng</label>
            <input type="number" id="quantity" class="form-control" min="1" value="1">
          </div>
          <div class="col-md-3 d-flex align-items-end">
            <button class="btn btn-success w-100" id="addToOrder">ThÃªm</button>
          </div>
        </div>
        <hr>
        <h6>Danh sÃ¡ch mÃ³n:</h6>
        <ul class="list-group" id="orderItems"></ul>
        <div class="text-end mt-3">
          <strong>Tá»•ng tiá»n: <span id="orderTotal">0</span> Ä‘</strong>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Há»§y</button>
        <button class="btn btn-primary" id="saveOrder">LÆ°u Ä‘Æ¡n</button>
      </div>
    </div>
  </div>
</div>

<script>
let menuItems = JSON.parse(localStorage.getItem("menuItems")) || [];
let orders = JSON.parse(localStorage.getItem("orders")) || [];
let editIndex = null;

// ================= MENU =================
function renderMenu(){
  const container = document.getElementById("menuItemsContainer");
  container.innerHTML = "";
  menuItems.forEach((item, index) => {
    container.innerHTML += `
      <div class="col-md-3 mb-3">
        <div class="card menu-item-card">
          <div class="card-body text-center">
            <h6>${item.name}</h6>
            <p>${item.price.toLocaleString()} Ä‘</p>
            <small class="text-muted">${item.category}</small>
            <div class="mt-2">
              <button class="btn btn-sm btn-warning" onclick="editMenuItem(${index})">âœï¸ Sá»­a</button>
              <button class="btn btn-sm btn-danger" onclick="deleteMenuItem(${index})">ğŸ—‘ï¸ XÃ³a</button>
            </div>
          </div>
        </div>
      </div>`;
  });

  // Cáº­p nháº­t select trong modal Ä‘Æ¡n
  const select = document.getElementById("menuSelect");
  select.innerHTML = menuItems.map((i, idx) =>
    `<option value="${idx}">${i.name} - ${i.price.toLocaleString()} Ä‘</option>`
  ).join("");

  localStorage.setItem("menuItems", JSON.stringify(menuItems));
}

function editMenuItem(index){
  editIndex = index;
  const item = menuItems[index];
  document.getElementById("itemName").value = item.name;
  document.getElementById("itemPrice").value = item.price;
  document.getElementById("itemCategory").value = item.category;
  document.querySelector("#addMenuItemModal .modal-title").textContent = "Sá»­a mÃ³n";
  new bootstrap.Modal(document.getElementById("addMenuItemModal")).show();
}

function deleteMenuItem(index){
  if(confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a mÃ³n nÃ y khÃ´ng?")){
    menuItems.splice(index, 1);
    renderMenu();
  }
}

document.getElementById("saveMenuItem").addEventListener("click", () => {
  const name = document.getElementById("itemName").value;
  const price = parseInt(document.getElementById("itemPrice").value);
  const category = document.getElementById("itemCategory").value;
  if(name && price){
    if(editIndex !== null){
      menuItems[editIndex] = { name, price, category };
      editIndex = null;
      document.querySelector("#addMenuItemModal .modal-title").textContent = "ThÃªm mÃ³n má»›i";
    } else {
      menuItems.push({ name, price, category });
    }
    renderMenu();
    document.querySelector("#addMenuItemModal .btn-close").click();
  }
});

// ================= ÄÆ N HÃ€NG =================
let currentOrder = [];

document.getElementById("addToOrder").addEventListener("click", () => {
  const idx = document.getElementById("menuSelect").value;
  const qty = parseInt(document.getElementById("quantity").value);
  if(menuItems[idx] && qty > 0){
    currentOrder.push({ ...menuItems[idx], qty });
    renderOrderItems();
  }
});

function renderOrderItems(){
  const list = document.getElementById("orderItems");
  let total = 0;
  list.innerHTML = "";
  currentOrder.forEach((item, i) => {
    const subtotal = item.price * item.qty;
    total += subtotal;
    list.innerHTML += `<li class="list-group-item d-flex justify-content-between">
      ${item.name} x${item.qty} 
      <strong>${subtotal.toLocaleString()} Ä‘</strong>
    </li>`;
  });
  document.getElementById("orderTotal").textContent = total.toLocaleString();
}

document.getElementById("saveOrder").addEventListener("click", () => {
  if(currentOrder.length === 0) return alert("ÄÆ¡n hÃ ng trá»‘ng!");
  const total = currentOrder.reduce((sum, i) => sum + i.price*i.qty, 0);
  orders.push({ date: new Date().toLocaleDateString("vi-VN"), items: currentOrder, total });
  localStorage.setItem("orders", JSON.stringify(orders));
  currentOrder = [];
  renderOrders();
  renderStats();
  renderChart();
  document.querySelector("#newOrderModal .btn-close").click();
});

// ================= HIá»‚N THá»Š ÄÆ N =================
function renderOrders(){
  const tbody = document.getElementById("ordersTable");
  tbody.innerHTML = "";
  orders.forEach((order, i) => {
    tbody.innerHTML += `<tr>
      <td>${i+1}</td>
      <td>${order.date}</td>
      <td>${order.items.map(it=>`${it.name} x${it.qty}`).join(", ")}</td>
      <td>${order.total.toLocaleString()} Ä‘</td>
    </tr>`;
  });
}

// ================= THá»NG KÃŠ =================
function renderStats(){
  document.getElementById("totalOrders").textContent = orders.length;
  const totalRevenue = orders.reduce((sum, o)=>sum+o.total, 0);
  document.getElementById("totalRevenue").textContent = totalRevenue.toLocaleString()+" Ä‘";

  // best seller
  let counts = {};
  orders.forEach(o => o.items.forEach(i => {
    counts[i.name] = (counts[i.name]||0) + i.qty;
  }));
  let best = Object.entries(counts).sort((a,b)=>b[1]-a[1])[0];
  document.getElementById("bestSeller").textContent = best ? best[0] : "ChÆ°a cÃ³";
}

// ================= BIá»‚U Äá»’ =================
let chart;
function renderChart(){
  const ctx = document.getElementById("revenueChart").getContext("2d");
  const grouped = {};
  orders.forEach(o => grouped[o.date] = (grouped[o.date]||0)+o.total);
  const labels = Object.keys(grouped);
  const data = Object.values(grouped);

  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "bar",
    data: { labels, datasets: [{ label: "Doanh thu", data }] }
  });
}

// ================= INIT =================
renderMenu();
renderOrders();
renderStats();
renderChart();
</script>
</body>
</html>
