<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<title>Bii Coffee ‚Äì ƒê·∫∑t m√≥n & Qu·∫£n l√Ω l·ª£i nhu·∫≠n</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="style.css"/>
</head>
<body>
<header>
  <h1>üßã Bii Coffee</h1>
  <p>üìç Trung M·∫ßu ‚Äì C·ªïng Ph·ª• B√° Thi·ªán 2 | ‚òé 0964 391 834 / 0928 020 777</p>
</header>

<!-- Thanh t√¨m ki·∫øm -->
<div id="search-area">
  <div id="search-container">
    <input id="search-input" placeholder="üîç T√¨m ki·∫øm m√≥n..." autocomplete="off"/>
    <button id="quick-search-toggle" onclick="toggleQuickSearch()">
      <i class="fas fa-tags"></i> <span>L·ªçc theo nh√≥m</span>
    </button>
  </div>
  <div id="quick-search"></div>
</div>

<!-- Menu ‚Äì s·∫Ω ƒë∆∞·ª£c render ƒë·ªông -->
<main id="menu-container"></main>

<!-- Gi·ªè h√†ng -->
<div id="cart" class="collapsed">
  <div id="cart-header" onclick="toggleCart()">
    üõí Gi·ªè h√†ng (<span id="cart-count">0</span>) <span id="cart-toggle">‚ñº</span>
  </div>
  <div id="cart-content">
    <ul id="cart-list"></ul>
    <div id="cart-total">T·ªïng: 0ƒë</div>
    <button class="btn" onclick="toggleDeliveryInfo()">‚úèÔ∏è Th√¥ng tin giao h√†ng</button>
    <textarea id="orderText" readonly></textarea>
    <button class="btn" onclick="copyOrder()">üìã Sao ch√©p</button>
    <button class="btn" onclick="sendToZalo()">üí¨ Zalo</button>
    <button class="btn" onclick="sendToMessenger()">üì® Messenger</button>
    <button class="btn" onclick="completeOrder()">‚úÖ Ho√†n th√†nh</button>
  </div>
</div>

<!-- Th·ªëng k√™ -->
<div id="profit-section" class="hidden">
  <h2>üìä Th·ªëng k√™ l·ª£i nhu·∫≠n</h2>
  <select id="time-range" onchange="changeTimeRange()">
    <option value="day">Ng√†y</option><option value="month">Th√°ng</option>
    <option value="year">NƒÉm</option><option value="custom">T√πy ch·ªçn</option>
  </select>
  <div id="date-pickers" class="hidden">
    <input type="date" id="start-date"/><input type="date" id="end-date"/>
  </div>
  <button class="btn" onclick="calculateProfit()">T√≠nh</button>

  <div id="profit-results">
    <p>Doanh thu: <b id="total-revenue">0</b></p>
    <p>Chi ph√≠: <b id="total-cost">0</b></p>
    <p>L·ª£i nhu·∫≠n: <b id="total-profit">0</b></p>
  </div>
  <canvas id="profit-chart" height="200"></canvas>

  <h3>Nh·∫≠p chi ph√≠ (ngh√¨n ƒë·ªìng)</h3>
  <input type="number" placeholder="Nguy√™n li·ªáu" id="material-cost">
  <input type="number" placeholder="Nh√¢n vi√™n" id="labor-cost">
  <input type="number" placeholder="ƒêi·ªán n∆∞·ªõc" id="utility-cost">
  <input type="number" placeholder="Kh√°c" id="other-cost">
  <button class="btn" onclick="saveActualCosts()">L∆∞u chi ph√≠</button>
</div>

<a href="https://zalo.me/0964391834" class="zalo-float-btn" target="_blank">üí¨ Chat Zalo</a>
<button id="show-profit-btn" onclick="toggleProfitSection()">üìà Xem th·ªëng k√™</button>

<div id="delivery-section" class="hidden">
  <input placeholder="T√™n" id="customer-name"/>
  <input placeholder="SƒêT" id="customer-phone"/>
  <textarea placeholder="ƒê·ªãa ch·ªâ" id="delivery-address"></textarea>
  <button class="btn" onclick="toggleDeliveryInfo()">ƒê√≥ng</button>
</div>

<div id="notification" class="notification">ƒê√£ th√™m v√†o gi·ªè h√†ng!</div>

<script src="app.js"></script>
</body>
</html>
:root{
  --primary:#2C5E9E;--green:#4CAF50;--red:#FF6B6B;
  --font-xs:clamp(12px,2.5vw,14px);--font-sm:clamp(14px,3vw,16px);
  --space-xs:clamp(4px,1vw,8px);--space-sm:clamp(8px,1.5vw,12px);
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Arial;}
body{background:#f5f5f5;color:#333;padding-top:140px;padding-bottom:80px;}
header{position:fixed;top:0;width:100%;background:var(--primary);color:#fff;text-align:center;padding:var(--space-sm);}
#search-area{position:fixed;top:70px;left:0;right:0;background:#6578ca;padding:var(--space-sm);display:flex;gap:var(--space-sm);z-index:90;}
#search-input{flex:1;padding:var(--space-sm);border-radius:20px;border:none;}
#quick-search{display:none;flex-wrap:wrap;gap:var(--space-xs);margin-top:var(--space-sm);}
.search-tag{background:#fff;border-radius:15px;padding:var(--space-xs) var(--space-sm);cursor:pointer;}
main{max-width:800px;margin:0 auto;padding:0 var(--space-sm);}
.item{display:flex;justify-content:space-between;align-items:center;background:#fff;margin:var(--space-sm) 0;padding:var(--space-sm);border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.08);}
.item-name{flex:1;font-weight:600;}
.item-controls{display:flex;gap:var(--space-sm);align-items:center;flex-wrap:wrap;}
.quantity-controls{display:flex;align-items:center;}
.quantity-controls button{width:30px;height:30px;border:none;background:var(--red);color:#fff;border-radius:3px;font-weight:bold;}
.quantity-controls input{width:40px;text-align:center;margin:0 var(--space-xs);}
.btn{background:var(--primary);color:#fff;border:none;border-radius:6px;padding:var(--space-sm) var(--space-md);cursor:pointer;margin:2px 0;}
#cart{position:fixed;left:var(--space-sm);bottom:var(--space-sm);width:clamp(300px,90%,350px);background:#fff;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.2);overflow:hidden;transition:.3s;max-height:60vh;}
#cart.collapsed{max-height:50px;}
#cart-header{background:var(--primary);color:#fff;padding:var(--space-sm);cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
#cart-content{padding:var(--space-sm);overflow-y:auto;max-height:calc(60vh - 50px);}
.cart-item{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-sm);}
#profit-section{position:fixed;right:var(--space-sm);bottom:80px;width:clamp(300px,90%,500px);background:#fff;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.2);padding:var(--space-sm);overflow-y:auto;max-height:70vh;}
.hidden{display:none;}
.notification{position:fixed;top:20px;right:20px;background:var(--green);color:#fff;padding:var(--space-sm) var(--space-md);border-radius:5px;transition:.3s;opacity:0;z-index:1000;}
.notification.show{opacity:1;}
.zalo-float-btn{position:fixed;bottom:80px;right:var(--space-sm);background:#0088cc;color:#fff;padding:var(--space-sm);border-radius:30px;text-decoration:none;}
#show-profit-btn{position:fixed;right:var(--space-sm);bottom:20px;background:var(--primary);color:#fff;border:none;border-radius:25px;padding:var(--space-sm);}
@media(max-width:600px){
  body{padding-top:120px;}
  #search-area{flex-direction:column;}
  #cart{width:calc(100% - var(--space-sm)*2);}
}
// ===================== DATA MENU =====================
const menuData = {
  TR√Ä:[{n:"Tr√† chanh",p:{M:10,L:15}},{n:"Tr√† ƒë√†o",p:{M:20,L:25}}],
  SODA:[{n:"Soda d√¢u",p:{M:20}}],
  "SINH T·ªê":[{n:"Sinh t·ªë b∆°",p:{M:30}}],
  "ƒê√Å XAY":[{n:"ƒê√° xay matcha",p:{M:35}}],
  "C√Ä PH√ä":[{n:"C√† ph√™ n√¢u",p:{M:20}}],
  "TR√Ä S·ªÆA":[{n:"Tr√† s·ªØa khoai m√¥n",p:{M:25,L:30}}],
  "S·ªÆA CHUA":[{n:"S·ªØa chua l·∫Øc d√¢u",p:{M:25}}],
  "N∆Ø·ªöC √âP":[{n:"N∆∞·ªõc √©p cam",p:{M:25}}],
  PIZZA:[{n:"Pizza x√∫c x√≠ch",p:{18:60,21:85}}],
  "ƒê·ªí ƒÇN V·∫∂T":[{n:"X√∫c x√≠ch",p:{c√°i:8}},{n:"Khoai t√¢y chi√™n",p:{ƒëƒ©a:25}}],
  "M·ª≤ CAY":[{n:"M·ª≥ cay x√∫c x√≠ch",p:{C·∫•p0:40}}],
  "B√öN ƒê·∫¨U":[{n:"B√∫n ƒë·∫≠u",p:{"ƒê·∫ßy ƒë·ªß":35}}]
};

// ===================== RENDER MENU =====================
function renderMenu(){
  const container=document.getElementById('menu-container');
  container.innerHTML='';
  for(const [group,items] of Object.entries(menuData)){
    const sec=document.createElement('section');
    sec.innerHTML=`<h2 class="menu-title">${group}</h2>`;
    items.forEach(i=>{
      const div=document.createElement('div');div.className='item';
      div.innerHTML=`
        <span class="item-name">${i.n}</span>
        <div class="item-controls">
          <select>${Object.entries(i.p).map(([s,p])=>`<option value="${i.n} - ${s} - ${p}k">${s} - ${p}k</option>`).join('')}</select>
          <div class="quantity-controls"><button onclick="changeQty(this,-1)">-</button><input type="number" value="1" min="1" class="qty"><button onclick="changeQty(this,1)">+</button></div>
          <input class="note" placeholder="Ghi ch√∫..."/>
          <button class="btn" onclick="addToCart(this)">Th√™m</button>
        </div>`;
      sec.appendChild(div);
    });
    container.appendChild(sec);
  }
}
// ===================== CART =====================
let cart=[];
function changeQty(btn,d){const i=btn.parentNode.querySelector('.qty');i.value=Math.max(1,+i.value+d);}
function addToCart(btn){
  const row=btn.closest('.item');
  const sel=row.querySelector('select');
  const [name,size,priceText]=sel.value.split(' - ');
  const price=+priceText.replace('k','');
  const qty=+row.querySelector('.qty').value;
  const note=row.querySelector('.note').value;
  const item={name,size,price,qty,note,key:`${sel.value}-${note}`};
  const idx=cart.findIndex(c=>c.key===item.key);
  idx>-1?cart[idx].qty+=qty:cart.push(item);
  updateCart();showNoti('ƒê√£ th√™m '+name);
}
function updateCart(){
  const list=document.getElementById('cart-list');list.innerHTML='';
  let total=0;
  cart.forEach((it,i)=>{
    total+=it.price*it.qty;
    const li=document.createElement('li');li.className='cart-item';
    li.innerHTML=`<span>${it.name} (${it.size}) x${it.qty} ${it.note?`(${it.note})`:''}</span><span>${it.price*it.qty}k</span><button onclick="removeCart(${i})">X</button>`;
    list.appendChild(li);
  });
  document.getElementById('cart-total').textContent='T·ªïng: '+total+'k';
  document.getElementById('cart-count').textContent=cart.length;
  localStorage.cart=JSON.stringify(cart);
}
function removeCart(i){cart.splice(i,1);updateCart();}
// ===================== UTILS =====================
function toggle(id){document.getElementById(id).classList.toggle('hidden');}
function toggleQuickSearch(){toggle('quick-search');}
function toggleCart(){document.getElementById('cart').classList.toggle('collapsed');}
function toggleDeliveryInfo(){toggle('delivery-section');}
function toggleProfitSection(){toggle('profit-section');calculateProfit();}
function showNoti(msg){
  const n=document.getElementById('notification');n.textContent=msg;
  n.classList.add('show');setTimeout(()=>n.classList.remove('show'),2000);
}
// ===================== SEARCH =====================
document.addEventListener('DOMContentLoaded',()=>{
  renderMenu();
  cart=JSON.parse(localStorage.cart||'[]');updateCart();
  document.getElementById('search-input').addEventListener('input',e=>{
    const v=e.target.value.toLowerCase();
    document.querySelectorAll('.item').forEach(it=>{
      it.style.display=it.textContent.toLowerCase().includes(v)?'flex':'none';
    });
  });
  // quick-search tags
  const tags=['TR√Ä','SODA','SINH T·ªê','ƒê√Å XAY','C√Ä PH√ä','TR√Ä S·ªÆA','S·ªÆA CHUA','N∆Ø·ªöC √âP','PIZZA','ƒê·ªí ƒÇN V·∫∂T','M·ª≤ CAY','B√öN ƒê·∫¨U'];
  document.getElementById('quick-search').innerHTML=tags.map(t=>`<span class="search-tag" onclick="document.getElementById('search-input').value='${t}';document.getElementById('search-input').dispatchEvent(new Event('input'))">${t}</span>`).join('');
});
// ===================== ORDER COPY / SEND =====================
function copyOrder(){
  const txt=document.getElementById('orderText');
  txt.value=cart.map((c,i)=>`${i+1}. ${c.name} - ${c.size} x${c.qty} - ${c.price*c.qty}k ${c.note?`(${c.note})`:''}`).join('\n')+`\nT·ªïng: ${cart.reduce((a,c)=>a+c.price*c.qty,0)}k`;
  navigator.clipboard.writeText(txt.value);
  showNoti('ƒê√£ sao ch√©p ƒë∆°n!');
}
function sendToZalo(){
  copyOrder();window.open('https://zalo.me/0964391834','_blank');
}
function sendToMessenger(){
  copyOrder();window.open('https://m.me/hoa.ciu.s.2025','_blank');
}
function completeOrder(){
  if(!cart.length)return showNoti('Gi·ªè tr·ªëng!');
  const orders=JSON.parse(localStorage.orders||'[]');
  orders.push({id:Date.now(),date:new Date(),items:cart});
  localStorage.orders=JSON.stringify(orders);
  cart=[];updateCart();showNoti('ƒê√£ l∆∞u ƒë∆°n!');
}
// ===================== PROFIT =====================
function calculateProfit(){
  const today=new Date().toISOString().slice(0,10);
  const orders=JSON.parse(localStorage.orders||'[]').filter(o=>o.date.slice(0,10)===today);
  const revenue=orders.reduce((a,o)=>a+o.items.reduce((b,i)=>b+i.price*i.qty,0),0)*1000;
  const cost=(+localStorage.costs||0)*1000;
  document.getElementById('total-revenue').textContent=revenue.toLocaleString('vi')+'ƒë';
  document.getElementById('total-cost').textContent=cost.toLocaleString('vi')+'ƒë';
  document.getElementById('total-profit').textContent=(revenue-cost).toLocaleString('vi')+'ƒë';
}
function saveActualCosts(){
  const c=+document.getElementById('material-cost').value*1000+
          +document.getElementById('labor-cost').value*1000+
          +document.getElementById('utility-cost').value*1000+
          +document.getElementById('other-cost').value*1000;
  localStorage.costs=c;calculateProfit();showNoti('ƒê√£ l∆∞u chi ph√≠');
}
