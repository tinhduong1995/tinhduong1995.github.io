<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>Bii Coffee - ƒê·∫∑t h√†ng</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    :root {
      --primary: #6f4e37;
      --secondary: #c0a080;
      --accent: #d8a868;
      --light: #f5f5f5;
      --dark: #333;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --telegram: #0088cc;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background-color: #f9f6f2;
      padding: 15px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 20px;
      padding: 15px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      position: relative;
    }
    
    #authHeader {
      position: absolute;
      top: 15px;
      right: 15px;
    }
    
    #loginBtn, #logoutBtn {
      background-color: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    
    #loginBtn:hover, #logoutBtn:hover {
      background-color: rgba(255,255,255,0.3);
    }
    
    h1 {
      font-size: 1.8rem;
      margin-bottom: 8px;
    }
    
    h2 {
      color: var(--primary);
      margin-bottom: 12px;
      padding-bottom: 6px;
      border-bottom: 2px solid var(--secondary);
      font-size: 1.3rem;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .flex {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
      align-items: center;
    }
    
    input, select, button, textarea {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 0.9rem;
      width: 100%;
    }
    
    button {
      background-color: var(--primary);
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      width: auto;
    }
    
    button:hover {
      background-color: var(--secondary);
    }
    
    button.success {
      background-color: var(--success);
    }
    
    /* Login modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }
    
    .modal-content {
      background-color: white;
      padding: 25px;
      border-radius: 10px;
      width: 100%;
      max-width: 400px;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .close {
      font-size: 1.5rem;
      cursor: pointer;
    }
    
    .login-form input {
      margin-bottom: 15px;
      width: 100%;
    }
    
    .login-form button {
      width: 100%;
      margin-top: 10px;
    }
    
    /* Order section styles */
    .telegram-status-badge {
      background-color: #e8f4fd;
      border-radius: 20px;
      padding: 5px 12px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 0.8rem;
      color: var(--telegram);
      margin-bottom: 10px;
    }
    
    .category-filter {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
      max-height: 100px;
      overflow-y: auto;
      padding: 5px;
    }
    
    .category-btn {
      padding: 6px 12px;
      background-color: #f0f0f0;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      font-size: 0.8rem;
      white-space: nowrap;
    }
    
    .category-btn.active {
      background-color: var(--primary);
      color: white;
    }
    
    .scrollable-menu-container {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 10px;
      background-color: #f9f9f9;
      margin-bottom: 15px;
    }
    
    /* Menu categories */
    .menu-category {
      margin-bottom: 15px;
    }
    
    .menu-category h3 {
      color: var(--primary);
      padding-bottom: 4px;
      border-bottom: 1px solid #ddd;
      margin-bottom: 8px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .menu-category h3 .toggle-icon {
      font-size: 0.7rem;
      transition: transform 0.3s;
    }
    
    .menu-category.collapsed h3 .toggle-icon {
      transform: rotate(-90deg);
    }
    
    .menu-category-content {
      overflow: hidden;
      transition: max-height 0.3s ease;
      max-height: 1000px;
    }
    
    .menu-category.collapsed .menu-category-content {
      max-height: 0;
    }
    
    .menu-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px dotted #eee;
    }
    
    .menu-item:last-child {
      border-bottom: none;
    }
    
    .menu-item-name {
      flex-grow: 1;
      font-size: 0.9rem;
    }
    
    .menu-item-price {
      color: var(--primary);
      font-weight: bold;
      margin: 0 8px;
      font-size: 0.9rem;
    }
    
    .add-item-btn {
      padding: 4px 8px;
      font-size: 0.7rem;
    }
    
    /* Compact menu view */
    .compact-menu-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 4px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .compact-menu-item:hover {
      background-color: #f0f0f0;
    }
    
    .compact-item-name {
      flex-grow: 1;
      font-size: 0.95rem;
    }
    
    .compact-item-price {
      color: var(--primary);
      font-weight: bold;
      font-size: 0.95rem;
      margin: 0 8px;
    }
    
    .compact-add-btn {
      padding: 4px 10px;
      font-size: 0.8rem;
      border-radius: 3px;
      background-color: var(--success);
    }
    
    .toggle-menu-view {
      display: block;
      text-align: center;
      margin: 8px 0;
      padding: 4px;
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 0.8rem;
      width: 100%;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      font-size: 0.9rem;
    }
    
    th {
      background-color: var(--primary);
      color: white;
      padding: 10px;
      text-align: left;
    }
    
    td {
      padding: 8px 10px;
      border-bottom: 1px solid #eee;
    }
    
    .cart-total {
      font-weight: bold;
      text-align: right;
      margin: 12px 0;
      font-size: 1.1rem;
      color: var(--primary);
    }
    
    /* Admin sections - hidden by default */
    .admin-only {
      display: none;
    }
    
    .admin-only.visible {
      display: block;
    }
    
    /* Admin badge */
    .admin-badge {
      background-color: var(--warning);
      color: var(--dark);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.8rem;
      display: inline-block;
      margin-left: 10px;
    }
    
    /* Notification */
    .notification {
      position: fixed;
      top: 15px;
      right: 15px;
      padding: 12px 16px;
      border-radius: 5px;
      color: white;
      background-color: var(--success);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      max-width: 80%;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.error {
      background-color: var(--danger);
    }
    
    /* Stats grid */
    .stats-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    
    .stat-box {
      background: white;
      padding: 12px;
      border-radius: 6px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .stat-value {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--primary);
    }
    
    /* Responsive */
    @media (min-width: 768px) {
      .stats-container {
        grid-template-columns: repeat(4, 1fr);
      }
    }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-coffee"></i> Bii Coffee</h1>
    <p>Qu√°n quen - Gi√° quen - N√©t quen</p>
    <div id="authHeader">
      <button id="loginBtn" onclick="showLoginModal()"><i class="fas fa-lock"></i> Qu·∫£n l√Ω</button>
      <button id="logoutBtn" onclick="logout()" style="display: none;"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</button>
    </div>
  </header>

  <div class="container">
    <!-- PUBLIC SECTION: Order - Lu√¥n hi·ªÉn th·ªã cho m·ªçi ng∆∞·ªùi -->
    <div class="section">
      <h2><i class="fas fa-shopping-cart"></i> ƒê·∫∑t h√†ng</h2>
      
      <div class="telegram-status-badge">
        <i class="fab fa-telegram"></i> ƒê∆°n h√†ng s·∫Ω g·ª≠i v·ªÅ Telegram qu√°n
      </div>
      
      <!-- Danh m·ª•c m√≥n -->
      <div class="category-filter" id="publicCategoryFilter">
        <!-- Categories will be inserted here -->
      </div>
      
      <!-- N√∫t chuy·ªÉn ch·∫ø ƒë·ªô xem menu -->
      <button class="toggle-menu-view" onclick="togglePublicMenuView()">
        <i class="fas fa-exchange-alt"></i> Chuy·ªÉn ch·∫ø ƒë·ªô xem menu
      </button>
      
      <!-- Menu -->
      <div class="scrollable-menu-container">
        <div id="publicMenu">
          <!-- Menu items will be inserted here -->
        </div>
      </div>
      
      <!-- Gi·ªè h√†ng -->
      <table id="cartTable">
        <thead>
          <tr><th>M√≥n</th><th>SL</th><th>ƒê∆°n gi√°</th><th>Th√†nh ti·ªÅn</th><th></th></tr>
        </thead>
        <tbody>
          <!-- Cart items -->
        </tbody>
      </table>
      
      <div class="cart-total" id="cartTotal">T·ªïng c·ªông: 0ƒë</div>
      
      <textarea id="orderNote" rows="2" placeholder="Ghi ch√∫ (v√≠ d·ª•: √≠t ƒë√°, mang v·ªÅ...)" style="width: 100%; margin-bottom: 10px;"></textarea>
      
      <button onclick="createOrder()" class="success" style="width: 100%;">
        <i class="fas fa-paper-plane"></i> G·ª≠i ƒë∆°n h√†ng
      </button>
    </div>

    <!-- ADMIN SECTION: Th·ªëng k√™ (Ch·ªâ hi·ªán khi ƒëƒÉng nh·∫≠p) -->
    <div id="statsSection" class="section admin-only">
      <h2>
        <i class="fas fa-chart-bar"></i> Th·ªëng k√™ 
        <span class="admin-badge">Admin</span>
      </h2>
      
      <div class="date-filter flex">
        <input type="date" id="statsDate" onchange="renderStats()">
        <button onclick="showTodayStats()">H√¥m nay</button>
        <button onclick="showAllStats()">T·∫•t c·∫£</button>
      </div>
      
      <div class="stats-container">
        <div class="stat-box">
          <div class="stat-label">T·ªïng ƒë∆°n</div>
          <div class="stat-value" id="totalOrders">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Doanh thu</div>
          <div class="stat-value" id="totalRevenue">0ƒë</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">ƒê∆°n cao nh·∫•t</div>
          <div class="stat-value" id="highestOrder">0ƒë</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">M√≥n b√°n ch·∫°y</div>
          <div class="stat-value" id="bestSeller">-</div>
        </div>
      </div>
      
      <div id="dailyStatsDetails" style="margin-top: 15px;"></div>
    </div>

    <!-- ADMIN SECTION: Qu·∫£n l√Ω ƒë∆°n h√†ng (Ch·ªâ hi·ªán khi ƒëƒÉng nh·∫≠p) -->
    <div id="ordersSection" class="section admin-only">
      <h2>
        <i class="fas fa-list"></i> ƒê∆°n h√†ng 
        <span class="admin-badge">Admin</span>
      </h2>
      
      <div class="flex">
        <input type="text" id="filterNote" placeholder="T√¨m ƒë∆°n h√†ng..." oninput="renderOrders()" style="flex: 1;">
        <select id="sortOrders" onchange="renderOrders()">
          <option value="newest">M·ªõi nh·∫•t</option>
          <option value="oldest">C≈© nh·∫•t</option>
          <option value="highest">Cao nh·∫•t</option>
        </select>
      </div>
      
      <div class="scrollable-menu-container">
        <table id="orderTable">
          <thead>
            <tr>
              <th>M√£</th>
              <th>M√≥n</th>
              <th>T·ªïng</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      
      <div class="cart-total" id="filterTotal">T·ªïng ƒë∆°n ƒë√£ l·ªçc: 0ƒë</div>
    </div>

    <!-- ADMIN SECTION: Qu·∫£n l√Ω menu (Ch·ªâ hi·ªán khi ƒëƒÉng nh·∫≠p) -->
    <div id="menuSection" class="section admin-only">
      <h2>
        <i class="fas fa-utensils"></i> Qu·∫£n l√Ω menu 
        <span class="admin-badge">Admin</span>
      </h2>
      
      <!-- Form th√™m m√≥n -->
      <div style="background: #f9f9f9; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
        <h3>Th√™m m√≥n m·ªõi</h3>
        <div class="flex">
          <input type="text" id="menuName" placeholder="T√™n m√≥n" style="flex: 2;">
          <input type="number" id="menuPrice" placeholder="Gi√°" min="0" style="flex: 1;">
          <select id="menuCategory" style="flex: 1;">
            <option value="TR√Ä">TR√Ä</option>
            <option value="SODA">SODA</option>
            <option value="SINH T·ªê">SINH T·ªê</option>
            <option value="ƒê√Å XAY">ƒê√Å XAY</option>
            <option value="C√Ä PH√ä">C√Ä PH√ä</option>
            <option value="TR√Ä S·ªÆA">TR√Ä S·ªÆA</option>
            <option value="S·ªÆA CHUA">S·ªÆA CHUA</option>
            <option value="N∆Ø·ªöC √âP">N∆Ø·ªöC √âP</option>
            <option value="PIZZA">PIZZA</option>
            <option value="ƒê·ªí ƒÇN V·∫∂T">ƒê·ªí ƒÇN V·∫∂T</option>
            <option value="M·ª≤ CAY">M·ª≤ CAY</option>
            <option value="B√öN ƒê·∫¨U">B√öN ƒê·∫¨U</option>
          </select>
          <button onclick="addMenuItem()"><i class="fas fa-plus"></i> Th√™m</button>
        </div>
      </div>
      
      <!-- B·ªô l·ªçc danh m·ª•c -->
      <div class="category-filter" id="adminCategoryFilter"></div>
      
      <!-- B·∫£ng menu -->
      <div class="scrollable-menu-container">
        <table class="menu-table">
          <thead>
            <tr><th>T√™n m√≥n</th><th>Danh m·ª•c</th><th>Gi√°</th><th>Thao t√°c</th></tr>
          </thead>
          <tbody id="menuTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal ƒëƒÉng nh·∫≠p -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-lock"></i> ƒêƒÉng nh·∫≠p</h2>
        <span class="close" onclick="closeLoginModal()">&times;</span>
      </div>
      <div class="login-form">
        <input type="password" id="passwordInput" placeholder="M·∫≠t kh·∫©u qu·∫£n l√Ω" onkeypress="if(event.key==='Enter') checkLogin()">
        <button onclick="checkLogin()"><i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p</button>
      </div>
    </div>
  </div>

  <!-- Modal ch·ªânh s·ª≠a ƒë∆°n h√†ng (Admin) -->
  <div id="editOrderModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Ch·ªânh s·ª≠a ƒë∆°n</h2>
        <span class="close" onclick="closeEditModal()">&times;</span>
      </div>
      <div id="editOrderItems"></div>
      <textarea id="editOrderNote" rows="3" placeholder="Ghi ch√∫" style="width: 100%; margin: 10px 0;"></textarea>
      <div class="cart-total" id="editOrderTotal"></div>
      <button onclick="saveEditedOrder()" class="success" style="width: 100%;">L∆∞u thay ƒë·ªïi</button>
    </div>
  </div>

  <!-- Modal ch·ªânh s·ª≠a m√≥n (Admin) -->
  <div id="editMenuItemModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>S·ª≠a m√≥n</h2>
        <span class="close" onclick="closeEditMenuItemModal()">&times;</span>
      </div>
      <input type="text" id="editMenuItemName" placeholder="T√™n m√≥n">
      <input type="number" id="editMenuItemPrice" placeholder="Gi√°" style="margin: 10px 0;">
      <select id="editMenuItemCategory">
        <option value="TR√Ä">TR√Ä</option>
        <option value="SODA">SODA</option>
        <option value="SINH T·ªê">SINH T·ªê</option>
        <option value="ƒê√Å XAY">ƒê√Å XAY</option>
        <option value="C√Ä PH√ä">C√Ä PH√ä</option>
        <option value="TR√Ä S·ªÆA">TR√Ä S·ªÆA</option>
        <option value="S·ªÆA CHUA">S·ªÆA CHUA</option>
        <option value="N∆Ø·ªöC √âP">N∆Ø·ªöC √âP</option>
        <option value="PIZZA">PIZZA</option>
        <option value="ƒê·ªí ƒÇN V·∫∂T">ƒê·ªí ƒÇN V·∫∂T</option>
        <option value="M·ª≤ CAY">M·ª≤ CAY</option>
        <option value="B√öN ƒê·∫¨U">B√öN ƒê·∫¨U</option>
      </select>
      <button onclick="saveEditedMenuItem()" class="success" style="width: 100%; margin-top: 15px;">L∆∞u</button>
    </div>
  </div>

  <div class="notification" id="notification"></div>

<script>
// =============================================
// C·∫§U H√åNH TELEGRAM - THAY ƒê·ªîI TH√îNG TIN C·ª¶A B·∫†N
// =============================================
const TELEGRAM_BOT_TOKEN = "8628768143:AAH7KlHFMESJNDYUQN_TkXBqSVblnM_r82o";
const TELEGRAM_CHAT_ID = "6315315253";
const ADMIN_PASSWORD = "admin123";
// =============================================

// Menu ƒë·∫ßy ƒë·ªß v·ªõi t·∫•t c·∫£ c√°c m√≥n t·ª´ file g·ªëc
let menuItems = [
  // TR√Ä
  { id: 1, name: "Tr√† chanh", price: 10000, category: "TR√Ä" },
  { id: 2, name: "Tr√† chanh nha ƒëam", price: 15000, category: "TR√Ä" },
  { id: 3, name: "Tr√† qu·∫•t", price: 10000, category: "TR√Ä" },
  { id: 4, name: "Tr√† qu·∫•t nha ƒëam", price: 15000, category: "TR√Ä" },
  { id: 5, name: "Tr√† d∆∞a l∆∞·ªõi", price: 20000, category: "TR√Ä" },
  { id: 6, name: "Tr√† ƒë√†o", price: 20000, category: "TR√Ä" },
  { id: 7, name: "Tr√† ƒë√†o cam x·∫£", price: 25000, category: "TR√Ä" },
  { id: 8, name: "Tr√† qu·∫•t l·∫Øc s·ªØa", price: 25000, category: "TR√Ä" },
  { id: 9, name: "Tr√† t√°o xanh", price: 25000, category: "TR√Ä" },
  { id: 10, name: "Tr√† v·∫£i", price: 25000, category: "TR√Ä" },
  { id: 11, name: "Tr√† d√¢u", price: 25000, category: "TR√Ä" },
  { id: 12, name: "Tr√† hoa qu·∫£ nhi·ªát ƒë·ªõi", price: 25000, category: "TR√Ä" },
  { id: 13, name: "Tr√† chanh b·∫°c h√†", price: 20000, category: "TR√Ä" },
  { id: 14, name: "Tr√† chanh d√¢u", price: 20000, category: "TR√Ä" },
  { id: 15, name: "Tr√† xo√†i chanh leo", price: 20000, category: "TR√Ä" },
  { id: 16, name: "Tr√† ƒë√†o chanh d√¢y", price: 20000, category: "TR√Ä" },
  { id: 17, name: "Tr√† ƒë√†o nh√†i", price: 20000, category: "TR√Ä" },
  { id: 18, name: "Tr√† chanh leo", price: 20000, category: "TR√Ä" },
  
  // SODA
  { id: 19, name: "Soda vi·ªát qu·∫•t", price: 20000, category: "SODA" },
  { id: 20, name: "Soda b·∫°c h√†", price: 20000, category: "SODA" },
  { id: 21, name: "Soda d√¢u", price: 20000, category: "SODA" },
  { id: 22, name: "Soda d∆∞a l∆∞·ªõi", price: 20000, category: "SODA" },
  
  // SINH T·ªê
  { id: 23, name: "Sinh t·ªë b∆°", price: 30000, category: "SINH T·ªê" },
  { id: 24, name: "Sinh t·ªë xo√†i", price: 30000, category: "SINH T·ªê" },
  { id: 25, name: "Sinh t·ªë d√¢u t√¢y", price: 30000, category: "SINH T·ªê" },
  
  // ƒê√Å XAY
  { id: 26, name: "ƒê√° xay vi·ªát qu·∫•t", price: 35000, category: "ƒê√Å XAY" },
  { id: 27, name: "ƒê√° xay matcha", price: 35000, category: "ƒê√Å XAY" },
  { id: 28, name: "ƒê√° xay b·∫°c h√†", price: 35000, category: "ƒê√Å XAY" },
  { id: 29, name: "ƒê√° xay khoai m√¥n", price: 35000, category: "ƒê√Å XAY" },
  
  // C√Ä PH√ä
  { id: 30, name: "C√† ph√™ b·∫°c x·ªâu", price: 25000, category: "C√Ä PH√ä" },
  { id: 31, name: "C√† ph√™ n√¢u s·ªØa", price: 20000, category: "C√Ä PH√ä" },
  { id: 32, name: "C√† ph√™ n√¢u n√≥ng", price: 20000, category: "C√Ä PH√ä" },
  
  // TR√Ä S·ªÆA
  { id: 33, name: "Tr√† s·ªØa khoai m√¥n", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 34, name: "Tr√† s·ªØa s·ªët xo√†i", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 35, name: "Tr√† s·ªØa socola", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 36, name: "Tr√† s·ªØa matcha", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 37, name: "Tr√† s·ªØa d∆∞a l∆∞·ªõi", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 38, name: "Tr√† s·ªØa h·ªìng tr√†", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 39, name: "Tr√† s·ªØa d√¢u", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 40, name: "Tr√† s·ªØa ƒë√†o", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 41, name: "Tr√† s·ªØa d·ª´a", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 42, name: "Tr√† s·ªØa l√° n·∫øp", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 43, name: "Tr√† s·ªØa t√°o xanh", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 44, name: "Tr√† s·ªØa caramen", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 45, name: "Tr√† s·ªØa h·∫°t d·∫ª", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 46, name: "Tr√† s·ªØa cacao", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 47, name: "Tr√† s·ªØa vi·ªát qu·∫•t", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 48, name: "Tr√† s·ªØa matcha latte", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 49, name: "Tr√† s·ªØa b·∫°c h√†", price: 25000, category: "TR√Ä S·ªÆA" },
  { id: 50, name: "Tr√† s·ªØa khoai lang t√≠m", price: 30000, category: "TR√Ä S·ªÆA" },
  { id: 51, name: "Tr√† s·ªØa tr√¢n ch√¢u ƒë∆∞·ªùng ƒëen", price: 30000, category: "TR√Ä S·ªÆA" },
  { id: 52, name: "Tr√† s·ªØa kem tr·ª©ng d·ª´a n∆∞·ªõng", price: 30000, category: "TR√Ä S·ªÆA" },
  { id: 53, name: "Tr√† s·ªØa s·ªët xo√†i kem b√¥ng", price: 30000, category: "TR√Ä S·ªÆA" },
  { id: 54, name: "Tr√† s·ªØa xo√†i matcha", price: 30000, category: "TR√Ä S·ªÆA" },
  { id: 55, name: "Tr√† s·ªØa khoai m√¥n kem d·ª´a n∆∞·ªõng", price: 30000, category: "TR√Ä S·ªÆA" },
  { id: 56, name: "Tr√† s·ªØa ƒë∆∞·ªùng ƒëen kem d·ª´a n∆∞·ªõng", price: 30000, category: "TR√Ä S·ªÆA" },
  { id: 57, name: "Tr√† s·ªØa khoai lang t√≠m kem tr·ª©ng", price: 35000, category: "TR√Ä S·ªÆA" },
  
  // S·ªÆA CHUA
  { id: 58, name: "S·ªØa chua l·∫Øc d√¢u", price: 25000, category: "S·ªÆA CHUA" },
  { id: 59, name: "S·ªØa chua l·∫Øc xo√†i", price: 25000, category: "S·ªÆA CHUA" },
  { id: 60, name: "S·ªØa chua l·∫Øc vi·ªát qu·∫•t", price: 25000, category: "S·ªÆA CHUA" },
  { id: 61, name: "S·ªØa chua hoa qu·∫£", price: 30000, category: "S·ªÆA CHUA" },
  
  // N∆Ø·ªöC √âP
  { id: 62, name: "N∆∞·ªõc √©p cam", price: 25000, category: "N∆Ø·ªöC √âP" },
  { id: 63, name: "N∆∞·ªõc √©p d∆∞a h·∫•u", price: 25000, category: "N∆Ø·ªöC √âP" },
  { id: 64, name: "N∆∞·ªõc √©p d·ª©a", price: 25000, category: "N∆Ø·ªöC √âP" },
  
  // PIZZA
  { id: 65, name: "Pizza x√∫c x√≠ch", price: 60000, category: "PIZZA" },
  { id: 66, name: "Pizza b√≤ ng√¥", price: 60000, category: "PIZZA" },
  { id: 67, name: "Pizza th·∫≠p c·∫©m", price: 60000, category: "PIZZA" },
  
  // ƒê·ªí ƒÇN V·∫∂T
  { id: 68, name: "X√∫c x√≠ch", price: 8000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 69, name: "L·∫°p x∆∞·ªüng", price: 8000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 70, name: "Ph√¥ mai que", price: 8000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 71, name: "H∆∞·ªõng d∆∞∆°ng ƒëen", price: 15000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 72, name: "H∆∞·ªõng d∆∞∆°ng tr·∫Øng", price: 15000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 73, name: "Khoai lang k√©n", price: 25000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 74, name: "Khoai t√¢y chi√™n", price: 25000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 75, name: "Nem chua r√°n", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 76, name: "Khoai m√¥n l·ªá ph·ªë", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 77, name: "M·ª±c v√≤ng chi√™n", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 78, name: "G√† vi√™n chi√™n", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 79, name: "G√† vi√™n chi√™n s·ªët cay", price: 35000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 80, name: "ƒê√πi g√† KFC", price: 25000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 81, name: "ƒê√πi g√† KFC s·ªët cay", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 82, name: "C√°nh g√† KFC", price: 25000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 83, name: "C√°nh g√† KFC s·ªët cay", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 84, name: "C√° vi√™n chi√™n", price: 25000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  { id: 85, name: "C√° vi√™n chi√™n s·ªët cay", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T" },
  
  // M·ª≤ CAY
  { id: 86, name: "M·ª≥ cay x√∫c x√≠ch", price: 40000, category: "M·ª≤ CAY" },
  { id: 87, name: "M·ª≥ cay b√≤", price: 45000, category: "M·ª≤ CAY" },
  { id: 88, name: "M·ª≥ cay s∆∞·ªùn s·ª•n", price: 45000, category: "M·ª≤ CAY" },
  { id: 89, name: "M·ª≥ cay h·∫£i s·∫£n", price: 50000, category: "M·ª≤ CAY" },
  { id: 90, name: "M·ª≥ cay th·∫≠p c·∫©m", price: 55000, category: "M·ª≤ CAY" },
  
  // B√öN ƒê·∫¨U
  { id: 91, name: "B√∫n ƒë·∫≠u ƒë·∫ßy ƒë·ªß", price: 35000, category: "B√öN ƒê·∫¨U" },
  { id: 92, name: "B√∫n ƒë·∫≠u th√™m b√∫n", price: 40000, category: "B√öN ƒê·∫¨U" },
  { id: 93, name: "B√∫n ƒë·∫≠u th√™m ƒë·∫≠u", price: 40000, category: "B√öN ƒê·∫¨U" },
  { id: 94, name: "B√∫n ƒë·∫≠u th√™m ch·∫£ c·ªëm", price: 45000, category: "B√öN ƒê·∫¨U" },
  { id: 95, name: "B√∫n ƒë·∫≠u th√™m d·ªìi s·ª•n", price: 45000, category: "B√öN ƒê·∫¨U" }
];

let orders = JSON.parse(localStorage.getItem("orders")) || [];
let cart = [];
let currentEditOrderIndex = -1;
let currentEditMenuItemIndex = -1;
let currentPublicCategory = "T·∫§T C·∫¢";
let currentAdminCategory = "T·∫§T C·∫¢";
let isLoggedIn = false;
let publicMenuCompactView = false;

// Kh·ªüi t·∫°o d·ªØ li·ªáu
function initializeData() {
  const savedMenu = localStorage.getItem("menuItems");
  if (savedMenu) {
    menuItems = JSON.parse(savedMenu);
  } else {
    // L∆∞u menu m·∫∑c ƒë·ªãnh v√†o localStorage
    localStorage.setItem("menuItems", JSON.stringify(menuItems));
  }
  
  // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
  const savedLogin = localStorage.getItem("isLoggedIn");
  if (savedLogin === "true") {
    isLoggedIn = true;
    showAdminSections();
  }
  
  updateAuthButtons();
}

// L∆∞u d·ªØ li·ªáu
function saveData() {
  localStorage.setItem("menuItems", JSON.stringify(menuItems));
  localStorage.setItem("orders", JSON.stringify(orders));
}

// ====== AUTHENTICATION ======
function showLoginModal() {
  document.getElementById("loginModal").style.display = "flex";
  document.getElementById("passwordInput").focus();
}

function closeLoginModal() {
  document.getElementById("loginModal").style.display = "none";
  document.getElementById("passwordInput").value = "";
}

function checkLogin() {
  const password = document.getElementById("passwordInput").value;
  if (password === ADMIN_PASSWORD) {
    isLoggedIn = true;
    localStorage.setItem("isLoggedIn", "true");
    showAdminSections();
    closeLoginModal();
    showNotification("ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
  } else {
    showNotification("Sai m·∫≠t kh·∫©u!", true);
  }
}

function logout() {
  isLoggedIn = false;
  localStorage.setItem("isLoggedIn", "false");
  hideAdminSections();
  showNotification("ƒê√£ ƒëƒÉng xu·∫•t");
}

function showAdminSections() {
  document.querySelectorAll('.admin-only').forEach(el => el.classList.add('visible'));
  document.getElementById('loginBtn').style.display = 'none';
  document.getElementById('logoutBtn').style.display = 'block';
  renderOrders();
  renderStats();
  renderMenuTable();
  renderAdminCategoryFilter();
}

function hideAdminSections() {
  document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('visible'));
  document.getElementById('loginBtn').style.display = 'block';
  document.getElementById('logoutBtn').style.display = 'none';
}

function updateAuthButtons() {
  if (isLoggedIn) {
    document.getElementById('loginBtn').style.display = 'none';
    document.getElementById('logoutBtn').style.display = 'block';
  } else {
    document.getElementById('loginBtn').style.display = 'block';
    document.getElementById('logoutBtn').style.display = 'none';
  }
}

// ====== TELEGRAM ======
async function sendTelegramMessage(message) {
  if (TELEGRAM_BOT_TOKEN === "YOUR_BOT_TOKEN_HERE" || TELEGRAM_CHAT_ID === "YOUR_CHAT_ID_HERE") {
    console.log("Ch∆∞a c·∫•u h√¨nh Telegram");
    return false;
  }
  
  try {
    const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        chat_id: TELEGRAM_CHAT_ID,
        text: message,
        parse_mode: "HTML"
      })
    });
    return response.ok;
  } catch (error) {
    console.error("L·ªói g·ª≠i Telegram:", error);
    return false;
  }
}

// ====== NOTIFICATION ======
function showNotification(message, isError = false) {
  const notification = document.getElementById("notification");
  notification.textContent = message;
  notification.className = "notification" + (isError ? " error" : "") + " show";
  setTimeout(() => notification.classList.remove("show"), 3000);
}

// ====== PUBLIC MENU ======
function togglePublicMenuView() {
  publicMenuCompactView = !publicMenuCompactView;
  renderPublicMenu();
}

function renderPublicMenu() {
  const container = document.getElementById("publicMenu");
  container.innerHTML = "";
  
  if (publicMenuCompactView) {
    renderCompactPublicMenu(container);
  } else {
    renderCategorizedPublicMenu(container);
  }
}

function renderCategorizedPublicMenu(container) {
  // Nh√≥m c√°c m√≥n theo danh m·ª•c
  const categories = {};
  menuItems.forEach(item => {
    if (!categories[item.category]) {
      categories[item.category] = [];
    }
    categories[item.category].push(item);
  });
  
  // Hi·ªÉn th·ªã c√°c m√≥n theo danh m·ª•c ƒë√£ ch·ªçn
  for (const category in categories) {
    if (currentPublicCategory !== "T·∫§T C·∫¢" && currentPublicCategory !== category) {
      continue;
    }
    
    const categoryDiv = document.createElement("div");
    categoryDiv.className = "menu-category";
    categoryDiv.innerHTML = `
      <h3>
        <span>${category}</span>
        <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
      </h3>
      <div class="menu-category-content">
        ${categories[category].map(item => `
          <div class="menu-item">
            <div class="menu-item-name">${item.name}</div>
            <div class="menu-item-price">${item.price.toLocaleString()}ƒë</div>
            <button class="add-item-btn" onclick="addToCart('${item.name.replace(/'/g, "\\'")}', ${item.price})">
              <i class="fas fa-cart-plus"></i> Th√™m
            </button>
          </div>
        `).join('')}
      </div>
    `;
    
    // Th√™m s·ª± ki·ªán click ƒë·ªÉ thu g·ªçn/m·ªü r·ªông danh m·ª•c
    const header = categoryDiv.querySelector('h3');
    header.onclick = (e) => {
      e.stopPropagation();
      categoryDiv.classList.toggle('collapsed');
    };
    
    container.appendChild(categoryDiv);
  }
}

function renderCompactPublicMenu(container) {
  // L·ªçc c√°c m√≥n theo danh m·ª•c n·∫øu c·∫ßn
  let filteredItems = menuItems;
  if (currentPublicCategory !== "T·∫§T C·∫¢") {
    filteredItems = menuItems.filter(item => item.category === currentPublicCategory);
  }
  
  filteredItems.forEach(item => {
    const itemDiv = document.createElement("div");
    itemDiv.className = "compact-menu-item";
    itemDiv.onclick = () => addToCart(item.name, item.price);
    itemDiv.innerHTML = `
      <span class="compact-item-name">${item.name}</span>
      <span class="compact-item-price">${item.price.toLocaleString()}ƒë</span>
      <button class="compact-add-btn" onclick="event.stopPropagation(); addToCart('${item.name.replace(/'/g, "\\'")}', ${item.price})">
        <i class="fas fa-plus"></i>
      </button>
    `;
    container.appendChild(itemDiv);
  });
}

function renderPublicCategoryFilter() {
  const filterDiv = document.getElementById("publicCategoryFilter");
  filterDiv.innerHTML = "";
  
  const allBtn = document.createElement("button");
  allBtn.className = `category-btn ${currentPublicCategory === "T·∫§T C·∫¢" ? "active" : ""}`;
  allBtn.textContent = "T·∫§T C·∫¢";
  allBtn.onclick = () => { 
    currentPublicCategory = "T·∫§T C·∫¢"; 
    renderPublicCategoryFilter(); 
    renderPublicMenu(); 
  };
  filterDiv.appendChild(allBtn);
  
  const categories = [...new Set(menuItems.map(item => item.category))];
  categories.sort().forEach(cat => {
    const btn = document.createElement("button");
    btn.className = `category-btn ${currentPublicCategory === cat ? "active" : ""}`;
    btn.textContent = cat;
    btn.onclick = () => { 
      currentPublicCategory = cat; 
      renderPublicCategoryFilter(); 
      renderPublicMenu(); 
    };
    filterDiv.appendChild(btn);
  });
}

// ====== CART ======
function addToCart(name, price) {
  const existing = cart.find(item => item.name === name);
  if (existing) {
    existing.qty++;
  } else {
    cart.push({ name, price, qty: 1 });
  }
  renderCart();
  showNotification(`ƒê√£ th√™m ${name}`);
}

function renderCart() {
  const tbody = document.querySelector("#cartTable tbody");
  tbody.innerHTML = "";
  let total = 0;
  
  if (cart.length === 0) {
    tbody.innerHTML = `<tr><td colspan="5" class="empty-state" style="text-align: center; padding: 20px;">Gi·ªè h√†ng tr·ªëng</td></tr>`;
    document.getElementById("cartTotal").textContent = "T·ªïng c·ªông: 0ƒë";
    return;
  }
  
  cart.forEach((item, index) => {
    const itemTotal = item.price * item.qty;
    total += itemTotal;
    tbody.innerHTML += `
      <tr>
        <td>${item.name}</td>
        <td>
          <button onclick="updateCartQty(${index}, -1)" style="padding: 2px 8px;">-</button>
          ${item.qty}
          <button onclick="updateCartQty(${index}, 1)" style="padding: 2px 8px;">+</button>
        </td>
        <td>${item.price.toLocaleString()}ƒë</td>
        <td>${itemTotal.toLocaleString()}ƒë</td>
        <td><button onclick="removeFromCart(${index})" style="background: #dc3545; padding: 5px 8px;"><i class="fas fa-trash"></i></button></td>
      </tr>
    `;
  });
  
  document.getElementById("cartTotal").textContent = `T·ªïng c·ªông: ${total.toLocaleString()}ƒë`;
}

function updateCartQty(index, delta) {
  if (cart[index].qty + delta < 1) {
    removeFromCart(index);
  } else {
    cart[index].qty += delta;
    renderCart();
  }
}

function removeFromCart(index) {
  cart.splice(index, 1);
  renderCart();
}

async function createOrder() {
  if (cart.length === 0) {
    showNotification("Gi·ªè h√†ng tr·ªëng!", true);
    return;
  }
  
  const note = document.getElementById("orderNote").value;
  const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
  const now = new Date();
  
  const order = {
    id: orders.length > 0 ? Math.max(...orders.map(o => o.id)) + 1 : 1,
    items: [...cart],
    note: note,
    total: total,
    time: now.toLocaleString("vi-VN"),
    date: now.toISOString().split('T')[0]
  };
  
  // T·∫°o n·ªôi dung Telegram
  let message = `<b>‚òï BII COFFEE - ƒê∆†N H√ÄNG M·ªöI #${order.id}</b>\n\n`;
  message += `üïí Th·ªùi gian: ${order.time}\n`;
  message += `üìù Ghi ch√∫: ${note || "Kh√¥ng c√≥"}\n\n`;
  message += `<b>CHI TI·∫æT M√ìN:</b>\n`;
  order.items.forEach(item => {
    message += `${item.name} x${item.qty} - ${(item.price * item.qty).toLocaleString()}ƒë\n`;
  });
  message += `\n<b>üí∞ T·ªîNG C·ªòNG: ${total.toLocaleString()}ƒë</b>\n`;
  message += `\nüè† ƒê·ªãa ch·ªâ: Trung M·∫ßu-C·ªïng ph·ª• KCN b√° hi·ªán 2\n`;
  message += `üìû ƒêi·ªán tho·∫°i: 0964 391 834\n`;
  message += `üíù C·∫£m ∆°n qu√Ω kh√°ch!`;
  
  // G·ª≠i Telegram
  const sent = await sendTelegramMessage(message);
  if (sent) {
    showNotification(`ƒê√£ g·ª≠i ƒë∆°n #${order.id} qua Telegram!`);
  } else {
    showNotification("ƒê√£ t·∫°o ƒë∆°n nh∆∞ng kh√¥ng g·ª≠i ƒë∆∞·ª£c Telegram", true);
  }
  
  // L∆∞u ƒë∆°n h√†ng
  orders.push(order);
  saveData();
  
  // X√≥a gi·ªè h√†ng
  cart = [];
  document.getElementById("orderNote").value = "";
  renderCart();
  
  if (isLoggedIn) {
    renderOrders();
    renderStats();
  }
}

// ====== ADMIN: QU·∫¢N L√ù MENU ======
function renderAdminCategoryFilter() {
  const filterDiv = document.getElementById("adminCategoryFilter");
  if (!filterDiv) return;
  
  filterDiv.innerHTML = "";
  const allBtn = document.createElement("button");
  allBtn.className = `category-btn ${currentAdminCategory === "T·∫§T C·∫¢" ? "active" : ""}`;
  allBtn.textContent = "T·∫§T C·∫¢";
  allBtn.onclick = () => { currentAdminCategory = "T·∫§T C·∫¢"; renderAdminCategoryFilter(); renderMenuTable(); };
  filterDiv.appendChild(allBtn);
  
  const categories = [...new Set(menuItems.map(item => item.category))];
  categories.sort().forEach(cat => {
    const btn = document.createElement("button");
    btn.className = `category-btn ${currentAdminCategory === cat ? "active" : ""}`;
    btn.textContent = cat;
    btn.onclick = () => { currentAdminCategory = cat; renderAdminCategoryFilter(); renderMenuTable(); };
    filterDiv.appendChild(btn);
  });
}

function renderMenuTable() {
  const tbody = document.getElementById("menuTableBody");
  if (!tbody) return;
  
  tbody.innerHTML = "";
  let filtered = menuItems;
  if (currentAdminCategory !== "T·∫§T C·∫¢") {
    filtered = menuItems.filter(item => item.category === currentAdminCategory);
  }
  
  if (filtered.length === 0) {
    tbody.innerHTML = `<tr><td colspan="4" style="text-align: center; padding: 20px;">Kh√¥ng c√≥ m√≥n n√†o</td></tr>`;
    return;
  }
  
  filtered.forEach((item, index) => {
    const originalIndex = menuItems.findIndex(m => m.id === item.id);
    tbody.innerHTML += `
      <tr>
        <td>${item.name}</td>
        <td>${item.category}</td>
        <td>${item.price.toLocaleString()}ƒë</td>
        <td>
          <button onclick="openEditMenuItemModal(${originalIndex})" style="background: #ffc107; color: #000; padding: 5px 10px;"><i class="fas fa-edit"></i></button>
          <button onclick="deleteMenuItem(${originalIndex})" style="background: #dc3545; padding: 5px 10px;"><i class="fas fa-trash"></i></button>
        </td>
      </tr>
    `;
  });
}

function addMenuItem() {
  const name = document.getElementById("menuName").value.trim();
  const price = parseInt(document.getElementById("menuPrice").value);
  const category = document.getElementById("menuCategory").value;
  
  if (!name || isNaN(price) || price <= 0) {
    showNotification("Nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!", true);
    return;
  }
  
  const newId = menuItems.length > 0 ? Math.max(...menuItems.map(m => m.id)) + 1 : 1;
  menuItems.push({ id: newId, name, price, category });
  saveData();
  
  // C·∫≠p nh·∫≠t giao di·ªán
  renderPublicMenu();
  renderPublicCategoryFilter();
  renderMenuTable();
  renderAdminCategoryFilter();
  
  document.getElementById("menuName").value = "";
  document.getElementById("menuPrice").value = "";
  showNotification("ƒê√£ th√™m m√≥n!");
}

function openEditMenuItemModal(index) {
  currentEditMenuItemIndex = index;
  const item = menuItems[index];
  document.getElementById("editMenuItemName").value = item.name;
  document.getElementById("editMenuItemPrice").value = item.price;
  document.getElementById("editMenuItemCategory").value = item.category;
  document.getElementById("editMenuItemModal").style.display = "flex";
}

function closeEditMenuItemModal() {
  document.getElementById("editMenuItemModal").style.display = "none";
}

function saveEditedMenuItem() {
  const name = document.getElementById("editMenuItemName").value.trim();
  const price = parseInt(document.getElementById("editMenuItemPrice").value);
  const category = document.getElementById("editMenuItemCategory").value;
  
  if (!name || isNaN(price) || price <= 0) return;
  
  menuItems[currentEditMenuItemIndex] = {
    ...menuItems[currentEditMenuItemIndex],
    name, price, category
  };
  
  saveData();
  renderPublicMenu();
  renderPublicCategoryFilter();
  renderMenuTable();
  closeEditMenuItemModal();
  showNotification("ƒê√£ c·∫≠p nh·∫≠t!");
}

function deleteMenuItem(index) {
  if (confirm("X√≥a m√≥n n√†y?")) {
    menuItems.splice(index, 1);
    saveData();
    renderPublicMenu();
    renderPublicCategoryFilter();
    renderMenuTable();
    showNotification("ƒê√£ x√≥a!");
  }
}

// ====== ADMIN: QU·∫¢N L√ù ƒê∆†N H√ÄNG ======
function renderOrders() {
  if (!isLoggedIn) return;
  
  const tbody = document.querySelector("#orderTable tbody");
  if (!tbody) return;
  
  const filter = document.getElementById("filterNote").value.toLowerCase();
  const sortBy = document.getElementById("sortOrders").value;
  
  let filtered = orders.filter(o => 
    o.note.toLowerCase().includes(filter) || 
    o.id.toString().includes(filter) ||
    o.items.some(i => i.name.toLowerCase().includes(filter))
  );
  
  // S·∫Øp x·∫øp
  if (sortBy === "newest") filtered.sort((a,b) => b.id - a.id);
  else if (sortBy === "oldest") filtered.sort((a,b) => a.id - b.id);
  else if (sortBy === "highest") filtered.sort((a,b) => b.total - a.total);
  
  const totalFiltered = filtered.reduce((sum, o) => sum + o.total, 0);
  document.getElementById("filterTotal").textContent = `T·ªïng ƒë∆°n ƒë√£ l·ªçc: ${totalFiltered.toLocaleString()}ƒë`;
  
  tbody.innerHTML = "";
  if (filtered.length === 0) {
    tbody.innerHTML = `<tr><td colspan="4" style="text-align: center; padding: 20px;">Kh√¥ng c√≥ ƒë∆°n h√†ng</td></tr>`;
    return;
  }
  
  filtered.forEach(order => {
    const originalIndex = orders.findIndex(o => o.id === order.id);
    const itemsShort = order.items.map(i => `${i.name} x${i.qty}`).join(", ").substring(0, 30);
    tbody.innerHTML += `
      <tr>
        <td>#${order.id}</td>
        <td>${itemsShort}${itemsShort.length >= 30 ? '...' : ''}</td>
        <td>${order.total.toLocaleString()}ƒë</td>
        <td>
          <button onclick="openEditModal(${originalIndex})" style="background: #ffc107; color: #000; padding: 5px 8px;"><i class="fas fa-edit"></i></button>
          <button onclick="deleteOrder(${originalIndex})" style="background: #dc3545; padding: 5px 8px;"><i class="fas fa-trash"></i></button>
        </td>
      </tr>
    `;
  });
}

function openEditModal(index) {
  currentEditOrderIndex = index;
  const order = orders[index];
  
  const container = document.getElementById("editOrderItems");
  container.innerHTML = "";
  
  order.items.forEach((item, i) => {
    container.innerHTML += `
      <div style="display: flex; align-items: center; gap: 5px; margin-bottom: 8px;">
        <span style="flex: 2;">${item.name}</span>
        <input type="number" value="${item.qty}" min="1" style="width: 60px;" onchange="updateOrderItemQty(${i}, this.value)">
        <span>${(item.price * item.qty).toLocaleString()}ƒë</span>
        <button onclick="removeOrderItem(${i})" style="background: #dc3545; padding: 5px;">X</button>
      </div>
    `;
  });
  
  document.getElementById("editOrderNote").value = order.note;
  updateEditOrderTotal();
  document.getElementById("editOrderModal").style.display = "flex";
}

function closeEditModal() {
  document.getElementById("editOrderModal").style.display = "none";
}

function updateOrderItemQty(itemIndex, qty) {
  qty = parseInt(qty);
  if (qty < 1) qty = 1;
  orders[currentEditOrderIndex].items[itemIndex].qty = qty;
  updateEditOrderTotal();
}

function removeOrderItem(itemIndex) {
  orders[currentEditOrderIndex].items.splice(itemIndex, 1);
  if (orders[currentEditOrderIndex].items.length === 0) {
    orders.splice(currentEditOrderIndex, 1);
    closeEditModal();
  } else {
    updateEditOrderTotal();
    openEditModal(currentEditOrderIndex);
  }
}

function updateEditOrderTotal() {
  const order = orders[currentEditOrderIndex];
  order.total = order.items.reduce((sum, item) => sum + (item.price * item.qty), 0);
  document.getElementById("editOrderTotal").textContent = `T·ªïng: ${order.total.toLocaleString()}ƒë`;
}

function saveEditedOrder() {
  orders[currentEditOrderIndex].note = document.getElementById("editOrderNote").value;
  orders[currentEditOrderIndex].time = "S·ª≠a: " + new Date().toLocaleString("vi-VN");
  saveData();
  renderOrders();
  renderStats();
  closeEditModal();
  showNotification("ƒê√£ c·∫≠p nh·∫≠t!");
}

function deleteOrder(index) {
  if (confirm("X√≥a ƒë∆°n h√†ng?")) {
    orders.splice(index, 1);
    saveData();
    renderOrders();
    renderStats();
    showNotification("ƒê√£ x√≥a!");
  }
}

// ====== ADMIN: TH·ªêNG K√ä ======
function renderStats() {
  if (!isLoggedIn) return;
  
  const dateInput = document.getElementById("statsDate").value;
  let filtered = orders;
  if (dateInput) {
    filtered = orders.filter(o => o.date === dateInput);
  }
  
  const totalOrders = filtered.length;
  const revenue = filtered.reduce((s, o) => s + o.total, 0);
  const highest = filtered.length ? Math.max(...filtered.map(o => o.total)) : 0;
  
  // M√≥n b√°n ch·∫°y
  const itemCount = {};
  filtered.forEach(o => o.items.forEach(i => {
    itemCount[i.name] = (itemCount[i.name] || 0) + i.qty;
  }));
  const topItem = Object.entries(itemCount).sort((a,b) => b[1] - a[1])[0];
  
  document.getElementById("totalOrders").textContent = totalOrders;
  document.getElementById("totalRevenue").textContent = revenue.toLocaleString() + "ƒë";
  document.getElementById("highestOrder").textContent = highest.toLocaleString() + "ƒë";
  document.getElementById("bestSeller").textContent = topItem ? `${topItem[0]} (${topItem[1]})` : "-";
  
  // Chi ti·∫øt
  const details = document.getElementById("dailyStatsDetails");
  if (dateInput && filtered.length > 0) {
    let html = "<h3>Chi ti·∫øt ƒë∆°n h√†ng</h3><table><tr><th>M√£</th><th>M√≥n</th><th>Ti·ªÅn</th></tr>";
    filtered.forEach(o => {
      html += `<tr><td>#${o.id}</td><td>${o.items.map(i => `${i.name} x${i.qty}`).join(", ").substring(0, 20)}...</td><td>${o.total.toLocaleString()}ƒë</td></tr>`;
    });
    html += "</table>";
    details.innerHTML = html;
  } else {
    details.innerHTML = "";
  }
}

function showTodayStats() {
  const today = new Date().toISOString().split('T')[0];
  document.getElementById("statsDate").value = today;
  renderStats();
}

function showAllStats() {
  document.getElementById("statsDate").value = "";
  renderStats();
}

// ====== INIT ======
initializeData();
renderPublicCategoryFilter();
renderPublicMenu();
renderCart();
</script>
</body>
</html>
