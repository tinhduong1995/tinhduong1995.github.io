<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>Bii Coffee - ƒê·∫∑t h√†ng</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #6f4e37;
      --secondary: #c0a080;
      --accent: #d8a868;
      --light: #f5f5f5;
      --dark: #333;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --telegram: #0088cc;
      --size-s: #4caf50;
      --size-l: #ff9800;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background-color: #f9f6f2;
      padding: 15px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 20px;
      padding: 15px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      position: relative;
    }
    
    #authHeader {
      position: absolute;
      top: 15px;
      right: 15px;
    }
    
    #loginBtn, #logoutBtn {
      background-color: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    
    #loginBtn:hover, #logoutBtn:hover {
      background-color: rgba(255,255,255,0.3);
    }
    
    h1 {
      font-size: 1.8rem;
      margin-bottom: 8px;
    }
    
    h2 {
      color: var(--primary);
      margin-bottom: 12px;
      padding-bottom: 6px;
      border-bottom: 2px solid var(--secondary);
      font-size: 1.3rem;
    }
    
    h3 {
      font-size: 1rem;
      color: var(--primary);
      margin-bottom: 10px;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .flex {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
      align-items: center;
    }
    
    input, select, button, textarea {
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 0.95rem;
      width: 100%;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(216, 168, 104, 0.2);
    }
    
    button {
      background-color: var(--primary);
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      width: auto;
    }
    
    button:hover {
      background-color: var(--secondary);
    }
    
    button.success {
      background-color: var(--success);
    }
    
    button.success:hover {
      background-color: #218838;
    }
    
    button.warning {
      background-color: var(--warning);
      color: var(--dark);
    }
    
    button.warning:hover {
      background-color: #e0a800;
    }
    
    button.danger {
      background-color: var(--danger);
    }
    
    button.danger:hover {
      background-color: #c82333;
    }
    
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    .out-of-stock {
      opacity: 0.6;
      background-color: #ffe6e6;
      position: relative;
    }
    
    .out-of-stock-badge {
      position: absolute;
      top: 5px;
      right: 5px;
      background: var(--danger);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.7rem;
      font-weight: bold;
    }
    
    .out-of-stock-label {
      color: var(--danger);
      font-weight: bold;
      font-size: 0.8rem;
      margin-top: 5px;
    }
    
    /* Size selector */
    .size-selector {
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }
    
    .size-btn {
      flex: 1;
      padding: 5px;
      font-size: 0.8rem;
      background-color: #f0f0f0;
      color: var(--dark);
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .size-btn.small-active {
      background-color: var(--size-s);
      color: white;
      border-color: var(--size-s);
    }
    
    .size-btn.large-active {
      background-color: var(--size-l);
      color: white;
      border-color: var(--size-l);
    }
    
    .size-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Customer info form */
    .customer-info {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid #e9ecef;
    }
    
    .customer-info h3 {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--primary);
      margin-bottom: 15px;
    }
    
    .customer-info h3 i {
      color: var(--telegram);
    }
    
    .input-group {
      margin-bottom: 12px;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 0.9rem;
      color: var(--dark);
    }
    
    .input-group input, .input-group textarea {
      background-color: white;
    }
    
    .input-group input:focus, .input-group textarea:focus {
      border-color: var(--telegram);
    }
    
    .input-with-icon {
      position: relative;
    }
    
    .input-with-icon i {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #aaa;
    }
    
    .input-with-icon input {
      padding-left: 35px;
    }
    
    /* Order summary */
    .order-summary {
      background-color: #fff3e0;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      border-left: 4px solid var(--accent);
    }
    
    .order-summary p {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    
    .order-summary .total {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--primary);
      border-top: 1px dashed var(--secondary);
      padding-top: 8px;
      margin-top: 8px;
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }
    
    .modal-content {
      background-color: white;
      padding: 25px;
      border-radius: 10px;
      width: 100%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .close {
      font-size: 1.5rem;
      cursor: pointer;
    }
    
    .close:hover {
      color: var(--danger);
    }
    
    /* Confirm order modal */
    .confirm-items {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #eee;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
    }
    
    .confirm-item {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px dotted #eee;
    }
    
    .confirm-item:last-child {
      border-bottom: none;
    }
    
    .confirm-info {
      background-color: #f8f9fa;
      padding: 12px;
      border-radius: 5px;
      margin: 10px 0;
    }
    
    .confirm-info p {
      margin: 8px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .confirm-info i {
      width: 20px;
      color: var(--primary);
    }
    
    .confirm-total {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--success);
      text-align: right;
      margin-top: 10px;
    }
    
    /* Category filter */
    .category-filter {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
      max-height: 100px;
      overflow-y: auto;
      padding: 5px;
    }
    
    .category-btn {
      padding: 8px 15px;
      background-color: #f0f0f0;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.85rem;
      white-space: nowrap;
      transition: all 0.3s;
    }
    
    .category-btn:hover {
      background-color: var(--secondary);
      color: white;
    }
    
    .category-btn.active {
      background-color: var(--primary);
      color: white;
    }
    
    /* Menu grid */
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      max-height: 450px;
      overflow-y: auto;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    
    .menu-item {
      background: white;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 8px;
      transition: transform 0.2s;
      position: relative;
    }
    
    .menu-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    
    .menu-item.out-of-stock {
      opacity: 0.7;
      background-color: #fff0f0;
      border: 1px solid var(--danger);
    }
    
    .menu-item-name {
      font-weight: bold;
      font-size: 1rem;
      color: var(--primary);
    }
    
    .menu-item-price {
      font-weight: bold;
      font-size: 0.95rem;
    }
    
    .price-small {
      color: var(--size-s);
    }
    
    .price-large {
      color: var(--size-l);
      margin-left: 5px;
    }
    
    .price-single {
      color: var(--primary);
    }
    
    .out-of-stock-tag {
      background-color: var(--danger);
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: bold;
      display: inline-block;
      margin-top: 5px;
      text-align: center;
    }
    
    .add-to-cart-btn {
      background: var(--success);
      color: white;
      border: none;
      padding: 8px;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      font-size: 0.9rem;
      margin-top: 5px;
    }
    
    .add-to-cart-btn:hover:not(:disabled) {
      background: #218838;
    }
    
    .add-to-cart-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    /* Cart table */
    .cart-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      font-size: 0.9rem;
    }
    
    .cart-table th {
      background: var(--primary);
      color: white;
      padding: 10px;
      text-align: left;
    }
    
    .cart-table td {
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
    
    .cart-table button {
      padding: 2px 8px;
      font-size: 0.8rem;
    }
    
    .size-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.7rem;
      font-weight: bold;
      margin-left: 5px;
    }
    
    .size-s-badge {
      background-color: var(--size-s);
      color: white;
    }
    
    .size-l-badge {
      background-color: var(--size-l);
      color: white;
    }
    
    .out-of-stock-row {
      background-color: #fff0f0;
    }
    
    .out-of-stock-row td {
      color: var(--danger);
    }
    
    .warning-text {
      color: var(--danger);
      font-weight: bold;
    }
    
    /* Admin sections */
    .admin-only {
      display: none;
    }
    
    .admin-only.visible {
      display: block;
    }
    
    .admin-badge {
      background-color: var(--warning);
      color: var(--dark);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.8rem;
      display: inline-block;
      margin-left: 10px;
    }
    
    /* Stats */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    
    .stat-box {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .stat-value {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--primary);
      margin-top: 5px;
    }
    
    /* Notification */
    .notification {
      position: fixed;
      top: 15px;
      right: 15px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      background-color: var(--success);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      max-width: 80%;
      font-size: 0.95rem;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.error {
      background-color: var(--danger);
    }
    
    .notification.warning {
      background-color: var(--warning);
      color: var(--dark);
    }
    
    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 30px;
      color: #999;
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 10px;
      color: #ddd;
    }
    
    /* Required field indicator */
    .required::after {
      content: " *";
      color: var(--danger);
    }
    
    /* Order card */
    .order-card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
    }
    
    .order-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .order-status {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    .status-new {
      background-color: #28a745;
      color: white;
    }
    
    .status-processing {
      background-color: #ffc107;
      color: var(--dark);
    }
    
    .status-completed {
      background-color: #6c757d;
      color: white;
    }
    
    .order-actions {
      display: flex;
      gap: 5px;
      margin-top: 10px;
    }
    
    .order-actions button {
      flex: 1;
      padding: 8px;
      font-size: 0.8rem;
    }
    
    /* Stock management */
    .stock-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
    }
    
    .stock-btn {
      flex: 1;
      padding: 10px;
      font-size: 0.9rem;
    }
    
    .stock-info {
      background: #e3f2fd;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .menu-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
      
      .stats-container {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-coffee"></i> Bii Coffee</h1>
    <p>Qu√°n quen - Gi√° quen - N√©t quen</p>
    <div id="authHeader">
      <button id="loginBtn" onclick="showLoginModal()"><i class="fas fa-lock"></i> Qu·∫£n l√Ω</button>
      <button id="logoutBtn" onclick="logout()" style="display: none;"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</button>
    </div>
  </header>

  <div class="container">
    <!-- PUBLIC ORDER SECTION -->
    <div class="section">
      <h2><i class="fas fa-shopping-cart"></i> ƒê·∫∑t h√†ng</h2>
      
      <div style="background: #e8f4fd; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
        <i class="fab fa-telegram"></i> ƒê∆°n h√†ng s·∫Ω ƒë∆∞·ª£c g·ª≠i v·ªÅ Telegram qu√°n ngay l·∫≠p t·ª©c
      </div>
      
      <!-- Category Filter -->
      <div class="category-filter" id="categoryFilter"></div>
      
      <!-- Menu Grid -->
      <div class="menu-grid" id="menuGrid"></div>
      
      <!-- Cart -->
      <table class="cart-table" id="cartTable">
        <thead>
          <tr>
            <th>M√≥n (Size)</th>
            <th>SL</th>
            <th>ƒê∆°n gi√°</th>
            <th>Th√†nh ti·ªÅn</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="cartBody"></tbody>
      </table>
      
      <!-- Customer Info -->
      <div class="customer-info">
        <h3>
          <i class="fas fa-user-circle"></i> Th√¥ng tin ng∆∞·ªùi nh·∫≠n
        </h3>
        
        <div class="input-group">
          <label class="required">S·ªë ƒëi·ªán tho·∫°i</label>
          <div class="input-with-icon">
            <i class="fas fa-phone-alt"></i>
            <input type="tel" id="customerPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" value="">
          </div>
        </div>
        
        <div class="input-group">
          <label class="required">ƒê·ªãa ch·ªâ</label>
          <div class="input-with-icon">
            <i class="fas fa-map-marker-alt"></i>
            <input type="text" id="customerAddress" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ nh·∫≠n h√†ng" value="">
          </div>
        </div>
        
        <div class="input-group">
          <label>Ghi ch√∫ th√™m</label>
          <textarea id="orderNote" rows="2" placeholder="V√≠ d·ª•: √≠t ƒë√°, kh√¥ng ƒë∆∞·ªùng, g·ªçi tr∆∞·ªõc khi giao..."></textarea>
        </div>
      </div>
      
      <!-- Order Summary -->
      <div class="order-summary">
        <p>
          <span>T·∫°m t√≠nh:</span>
          <span id="subtotal">0ƒë</span>
        </p>
        <p>
          <span>Ph√≠ giao h√†ng:</span>
          <span>0ƒë</span>
        </p>
        <p class="total">
          <span>T·ªïng c·ªông:</span>
          <span id="cartTotal">0ƒë</span>
        </p>
      </div>
      
      <!-- Submit Button -->
      <button onclick="showConfirmModal()" class="success" style="width: 100%; padding: 15px; font-size: 1.1rem;">
        <i class="fas fa-check-circle"></i> XEM L·∫†I ƒê∆†N H√ÄNG
      </button>
    </div>

    <!-- ADMIN STATS SECTION -->
    <div id="statsSection" class="section admin-only">
      <h2>
        <i class="fas fa-chart-bar"></i> Th·ªëng k√™ 
        <span class="admin-badge">Admin</span>
      </h2>
      
      <div class="flex">
        <input type="date" id="statsDate" style="flex: 1;">
        <button onclick="showTodayStats()">H√¥m nay</button>
        <button onclick="showAllStats()">T·∫•t c·∫£</button>
      </div>
      
      <div class="stats-container">
        <div class="stat-box">
          <div class="stat-label">T·ªïng ƒë∆°n</div>
          <div class="stat-value" id="totalOrders">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Doanh thu</div>
          <div class="stat-value" id="totalRevenue">0ƒë</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">ƒê∆°n cao nh·∫•t</div>
          <div class="stat-value" id="highestOrder">0ƒë</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">M√≥n b√°n ch·∫°y</div>
          <div class="stat-value" id="bestSeller">-</div>
        </div>
      </div>
      
      <div id="recentOrders" style="margin-top: 20px;"></div>
    </div>

    <!-- ADMIN ORDERS SECTION -->
    <div id="ordersSection" class="section admin-only">
      <h2>
        <i class="fas fa-list"></i> Qu·∫£n l√Ω ƒë∆°n h√†ng 
        <span class="admin-badge">Admin</span>
      </h2>
      
      <div class="flex">
        <input type="text" id="searchOrders" placeholder="T√¨m ki·∫øm (SƒêT, t√™n, ƒë·ªãa ch·ªâ...)" style="flex: 2;">
        <select id="orderStatus" style="flex: 1;">
          <option value="all">T·∫•t c·∫£</option>
          <option value="new">M·ªõi</option>
          <option value="processing">ƒêang x·ª≠ l√Ω</option>
          <option value="completed">Ho√†n th√†nh</option>
        </select>
        <button onclick="loadOrders()"><i class="fas fa-sync-alt"></i> L√†m m·ªõi</button>
      </div>
      
      <div id="ordersList" style="max-height: 500px; overflow-y: auto;"></div>
    </div>

    <!-- ADMIN MENU SECTION -->
    <div id="menuSection" class="section admin-only">
      <h2>
        <i class="fas fa-utensils"></i> Qu·∫£n l√Ω menu 
        <span class="admin-badge">Admin</span>
      </h2>
      
      <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
        <h3>Th√™m m√≥n m·ªõi</h3>
        <div class="flex">
          <input type="text" id="menuName" placeholder="T√™n m√≥n" style="flex: 2;">
          <input type="number" id="menuPriceS" placeholder="Gi√° S" style="flex: 1;">
          <input type="number" id="menuPriceL" placeholder="Gi√° L" style="flex: 1;">
          <select id="menuCategory" style="flex: 1;">
            <option value="TR√Ä">TR√Ä</option>
            <option value="SODA">SODA</option>
            <option value="SINH T·ªê">SINH T·ªê</option>
            <option value="ƒê√Å XAY">ƒê√Å XAY</option>
            <option value="C√Ä PH√ä">C√Ä PH√ä</option>
            <option value="TR√Ä S·ªÆA">TR√Ä S·ªÆA</option>
            <option value="S·ªÆA CHUA">S·ªÆA CHUA</option>
            <option value="N∆Ø·ªöC √âP">N∆Ø·ªöC √âP</option>
            <option value="PIZZA">PIZZA</option>
            <option value="ƒê·ªí ƒÇN V·∫∂T">ƒê·ªí ƒÇN V·∫∂T</option>
            <option value="M·ª≤ CAY">M·ª≤ CAY</option>
            <option value="B√öN ƒê·∫¨U">B√öN ƒê·∫¨U</option>
          </select>
          <button onclick="addMenuItem()"><i class="fas fa-plus"></i> Th√™m</button>
        </div>
        <small><i class="fas fa-info-circle"></i> N·∫øu m√≥n ch·ªâ c√≥ 1 size, nh·∫≠p gi√° v√†o √¥ S v√† ƒë·ªÉ tr·ªëng √¥ L</small>
      </div>
      
      <!-- QU·∫¢N L√ù KHO H√ÄNG -->
      <div class="stock-controls">
        <input type="text" id="outOfStockItem" placeholder="Nh·∫≠p t√™n m√≥n h·∫øt (VD: Tr√† s·ªØa khoai m√¥n)" style="flex: 3;">
        <button onclick="markOutOfStock()" class="danger" style="flex: 1;"><i class="fas fa-times-circle"></i> B√°o h·∫øt</button>
        <button onclick="markInStock()" class="success" style="flex: 1;"><i class="fas fa-check-circle"></i> B√°o c√≤n</button>
      </div>
      
      <!-- Danh s√°ch m√≥n h·∫øt -->
      <div id="outOfStockList" class="stock-info"></div>
      
      <div class="category-filter" id="adminCategoryFilter"></div>
      
      <div style="max-height: 400px; overflow-y: auto;">
        <table style="width: 100%;">
          <thead>
            <tr>
              <th>T√™n m√≥n</th>
              <th>Danh m·ª•c</th>
              <th>Gi√° S</th>
              <th>Gi√° L</th>
              <th>Tr·∫°ng th√°i</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody id="menuTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <h2><i class="fas fa-lock"></i> ƒêƒÉng nh·∫≠p qu·∫£n l√Ω</h2>
      <input type="password" id="adminPassword" placeholder="M·∫≠t kh·∫©u" style="width: 100%; margin: 15px 0;">
      <button onclick="checkLogin()" style="width: 100%;">ƒêƒÉng nh·∫≠p</button>
    </div>
  </div>

  <!-- Confirm Order Modal -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-check-circle" style="color: var(--success);"></i> X√°c nh·∫≠n ƒë∆°n h√†ng</h2>
        <span class="close" onclick="closeConfirmModal()">&times;</span>
      </div>
      
      <div id="confirmContent">
        <div class="confirm-info">
          <p><i class="fas fa-phone-alt"></i> <span id="confirmPhone"></span></p>
          <p><i class="fas fa-map-marker-alt"></i> <span id="confirmAddress"></span></p>
          <p><i class="fas fa-pencil-alt"></i> <span id="confirmNote"></span></p>
        </div>
        
        <h3>M√≥n ƒë√£ ch·ªçn:</h3>
        <div class="confirm-items" id="confirmItems"></div>
        
        <div class="confirm-total" id="confirmTotal"></div>
      </div>
      
      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button onclick="closeConfirmModal()" class="warning" style="flex: 1;">
          <i class="fas fa-edit"></i> S·ª≠a l·∫°i
        </button>
        <button onclick="createOrder()" class="success" style="flex: 2;">
          <i class="fas fa-paper-plane"></i> X√ÅC NH·∫¨N G·ª¨I
        </button>
      </div>
    </div>
  </div>

  <!-- Out of Stock Alert Modal -->
  <div id="outOfStockModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 style="color: var(--danger);"><i class="fas fa-exclamation-triangle"></i> Th√¥ng b√°o</h2>
        <span class="close" onclick="closeOutOfStockModal()">&times;</span>
      </div>
      
      <div id="outOfStockModalContent" style="text-align: center;">
        <i class="fas fa-frown" style="font-size: 4rem; color: var(--danger); margin: 20px 0;"></i>
        <h3>ƒê∆°n h√†ng c·ªßa b·∫°n c√≥ m√≥n ƒë√£ h·∫øt!</h3>
        <div id="outOfStockListModal" style="margin: 20px 0; text-align: left;"></div>
        <p style="color: #666;">Vui l√≤ng x√≥a c√°c m√≥n tr√™n kh·ªèi gi·ªè h√†ng ƒë·ªÉ ti·∫øp t·ª•c.</p>
      </div>
      
      <button onclick="closeOutOfStockModal()" class="danger" style="width: 100%; margin-top: 20px;">
        <i class="fas fa-check"></i> ƒê√£ hi·ªÉu
      </button>
    </div>
  </div>

  <!-- Order Detail Modal -->
  <div id="orderDetailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Chi ti·∫øt ƒë∆°n h√†ng</h2>
        <span class="close" onclick="closeOrderDetailModal()">&times;</span>
      </div>
      <div id="orderDetailContent"></div>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <script>
    // =============================================
    // C·∫§U H√åNH TELEGRAM
    // =============================================
    const TELEGRAM_BOT_TOKEN = "8628768143:AAH7KlHFMESJNDYUQN_TkXBqSVblnM_r82o";
    const TELEGRAM_CHAT_ID = "6315315253";
    const ADMIN_PASSWORD = "admin123";

    // =============================================
    // D·ªÆ LI·ªÜU MENU (ƒê·∫¶Y ƒê·ª¶ 95 M√ìN)
    // =============================================
    let menuItems = [
      // TR√Ä (18 m√≥n) - C√≥ size L
      { id: 1, name: "Tr√† chanh", priceS: 10000, priceL: 15000, category: "TR√Ä", hasSize: true },
      { id: 2, name: "Tr√† chanh nha ƒëam", priceS: 15000, priceL: 20000, category: "TR√Ä", hasSize: true },
      { id: 3, name: "Tr√† qu·∫•t", priceS: 10000, priceL: 15000, category: "TR√Ä", hasSize: true },
      { id: 4, name: "Tr√† qu·∫•t nha ƒëam", priceS: 15000, priceL: 20000, category: "TR√Ä", hasSize: true },
      { id: 5, name: "Tr√† d∆∞a l∆∞·ªõi", priceS: 20000, priceL: 25000, category: "TR√Ä", hasSize: true },
      { id: 6, name: "Tr√† ƒë√†o", priceS: 20000, priceL: 25000, category: "TR√Ä", hasSize: true },
      { id: 7, name: "Tr√† ƒë√†o cam x·∫£", priceS: 25000, priceL: 30000, category: "TR√Ä", hasSize: true },
      { id: 8, name: "Tr√† qu·∫•t l·∫Øc s·ªØa", priceS: 25000, priceL: 30000, category: "TR√Ä", hasSize: true },
      { id: 9, name: "Tr√† t√°o xanh", priceS: 25000, priceL: 30000, category: "TR√Ä", hasSize: true },
      { id: 10, name: "Tr√† v·∫£i", priceS: 25000, priceL: 30000, category: "TR√Ä", hasSize: true },
      { id: 11, name: "Tr√† d√¢u", priceS: 25000, priceL: 30000, category: "TR√Ä", hasSize: true },
      { id: 12, name: "Tr√† hoa qu·∫£ nhi·ªát ƒë·ªõi", priceS: 25000, priceL: 30000, category: "TR√Ä", hasSize: true },
      { id: 13, name: "Tr√† chanh b·∫°c h√†", priceS: 20000, priceL: 25000, category: "TR√Ä", hasSize: true },
      { id: 14, name: "Tr√† chanh d√¢u", priceS: 20000, priceL: 25000, category: "TR√Ä", hasSize: true },
      { id: 15, name: "Tr√† xo√†i chanh leo", priceS: 20000, priceL: 25000, category: "TR√Ä", hasSize: true },
      { id: 16, name: "Tr√† ƒë√†o chanh d√¢y", priceS: 20000, priceL: 25000, category: "TR√Ä", hasSize: true },
      { id: 17, name: "Tr√† ƒë√†o nh√†i", priceS: 20000, priceL: 25000, category: "TR√Ä", hasSize: true },
      { id: 18, name: "Tr√† chanh leo", priceS: 20000, priceL: 25000, category: "TR√Ä", hasSize: true },
      
      // SODA (4 m√≥n)
      { id: 19, name: "Soda vi·ªát qu·∫•t", price: 20000, category: "SODA", hasSize: false },
      { id: 20, name: "Soda b·∫°c h√†", price: 20000, category: "SODA", hasSize: false },
      { id: 21, name: "Soda d√¢u", price: 20000, category: "SODA", hasSize: false },
      { id: 22, name: "Soda d∆∞a l∆∞·ªõi", price: 20000, category: "SODA", hasSize: false },
      
      // SINH T·ªê (3 m√≥n)
      { id: 23, name: "Sinh t·ªë b∆°", price: 30000, category: "SINH T·ªê", hasSize: false },
      { id: 24, name: "Sinh t·ªë xo√†i", price: 30000, category: "SINH T·ªê", hasSize: false },
      { id: 25, name: "Sinh t·ªë d√¢u t√¢y", price: 30000, category: "SINH T·ªê", hasSize: false },
      
      // ƒê√Å XAY (4 m√≥n)
      { id: 26, name: "ƒê√° xay vi·ªát qu·∫•t", price: 35000, category: "ƒê√Å XAY", hasSize: false },
      { id: 27, name: "ƒê√° xay matcha", price: 35000, category: "ƒê√Å XAY", hasSize: false },
      { id: 28, name: "ƒê√° xay b·∫°c h√†", price: 35000, category: "ƒê√Å XAY", hasSize: false },
      { id: 29, name: "ƒê√° xay khoai m√¥n", price: 35000, category: "ƒê√Å XAY", hasSize: false },
      
      // C√Ä PH√ä (3 m√≥n)
      { id: 30, name: "C√† ph√™ b·∫°c x·ªâu", price: 25000, category: "C√Ä PH√ä", hasSize: false },
      { id: 31, name: "C√† ph√™ n√¢u s·ªØa", price: 20000, category: "C√Ä PH√ä", hasSize: false },
      { id: 32, name: "C√† ph√™ n√¢u n√≥ng", price: 20000, category: "C√Ä PH√ä", hasSize: false },
      
      // TR√Ä S·ªÆA (25 m√≥n) - C√≥ size L
      { id: 33, name: "Tr√† s·ªØa khoai m√¥n", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 34, name: "Tr√† s·ªØa s·ªët xo√†i", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 35, name: "Tr√† s·ªØa socola", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 36, name: "Tr√† s·ªØa matcha", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 37, name: "Tr√† s·ªØa d∆∞a l∆∞·ªõi", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 38, name: "Tr√† s·ªØa h·ªìng tr√†", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 39, name: "Tr√† s·ªØa d√¢u", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 40, name: "Tr√† s·ªØa ƒë√†o", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 41, name: "Tr√† s·ªØa d·ª´a", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 42, name: "Tr√† s·ªØa l√° n·∫øp", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 43, name: "Tr√† s·ªØa t√°o xanh", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 44, name: "Tr√† s·ªØa caramen", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 45, name: "Tr√† s·ªØa h·∫°t d·∫ª", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 46, name: "Tr√† s·ªØa cacao", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 47, name: "Tr√† s·ªØa vi·ªát qu·∫•t", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 48, name: "Tr√† s·ªØa matcha latte", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 49, name: "Tr√† s·ªØa b·∫°c h√†", priceS: 25000, priceL: 30000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 50, name: "Tr√† s·ªØa khoai lang t√≠m", priceS: 30000, priceL: 35000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 51, name: "Tr√† s·ªØa tr√¢n ch√¢u ƒë∆∞·ªùng ƒëen", priceS: 30000, priceL: 35000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 52, name: "Tr√† s·ªØa kem tr·ª©ng d·ª´a n∆∞·ªõng", priceS: 30000, priceL: 35000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 53, name: "Tr√† s·ªØa s·ªët xo√†i kem b√¥ng", priceS: 30000, priceL: 35000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 54, name: "Tr√† s·ªØa xo√†i matcha", priceS: 30000, priceL: 35000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 55, name: "Tr√† s·ªØa khoai m√¥n kem d·ª´a n∆∞·ªõng", priceS: 30000, priceL: 35000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 56, name: "Tr√† s·ªØa ƒë∆∞·ªùng ƒëen kem d·ª´a n∆∞·ªõng", priceS: 30000, priceL: 35000, category: "TR√Ä S·ªÆA", hasSize: true },
      { id: 57, name: "Tr√† s·ªØa khoai lang t√≠m kem tr·ª©ng", priceS: 35000, priceL: 40000, category: "TR√Ä S·ªÆA", hasSize: true },
      
      // S·ªÆA CHUA (4 m√≥n)
      { id: 58, name: "S·ªØa chua l·∫Øc d√¢u", price: 25000, category: "S·ªÆA CHUA", hasSize: false },
      { id: 59, name: "S·ªØa chua l·∫Øc xo√†i", price: 25000, category: "S·ªÆA CHUA", hasSize: false },
      { id: 60, name: "S·ªØa chua l·∫Øc vi·ªát qu·∫•t", price: 25000, category: "S·ªÆA CHUA", hasSize: false },
      { id: 61, name: "S·ªØa chua hoa qu·∫£", price: 30000, category: "S·ªÆA CHUA", hasSize: false },
      
      // N∆Ø·ªöC √âP (3 m√≥n) - C√≥ size L
      { id: 62, name: "N∆∞·ªõc √©p cam", priceS: 25000, priceL: 30000, category: "N∆Ø·ªöC √âP", hasSize: true },
      { id: 63, name: "N∆∞·ªõc √©p d∆∞a h·∫•u", priceS: 25000, priceL: 30000, category: "N∆Ø·ªöC √âP", hasSize: true },
      { id: 64, name: "N∆∞·ªõc √©p d·ª©a", priceS: 25000, priceL: 30000, category: "N∆Ø·ªöC √âP", hasSize: true },
      
      // PIZZA (3 m√≥n)
      { id: 65, name: "Pizza x√∫c x√≠ch", price: 60000, category: "PIZZA", hasSize: false },
      { id: 66, name: "Pizza b√≤ ng√¥", price: 60000, category: "PIZZA", hasSize: false },
      { id: 67, name: "Pizza th·∫≠p c·∫©m", price: 60000, category: "PIZZA", hasSize: false },
      
      // ƒê·ªí ƒÇN V·∫∂T (18 m√≥n)
      { id: 68, name: "X√∫c x√≠ch", price: 8000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 69, name: "L·∫°p x∆∞·ªüng", price: 8000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 70, name: "Ph√¥ mai que", price: 8000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 71, name: "H∆∞·ªõng d∆∞∆°ng ƒëen", price: 15000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 72, name: "H∆∞·ªõng d∆∞∆°ng tr·∫Øng", price: 15000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 73, name: "Khoai lang k√©n", price: 25000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 74, name: "Khoai t√¢y chi√™n", price: 25000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 75, name: "Nem chua r√°n", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 76, name: "Khoai m√¥n l·ªá ph·ªë", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 77, name: "M·ª±c v√≤ng chi√™n", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 78, name: "G√† vi√™n chi√™n", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 79, name: "G√† vi√™n chi√™n s·ªët cay", price: 35000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 80, name: "ƒê√πi g√† KFC", price: 25000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 81, name: "ƒê√πi g√† KFC s·ªët cay", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 82, name: "C√°nh g√† KFC", price: 25000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 83, name: "C√°nh g√† KFC s·ªët cay", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 84, name: "C√° vi√™n chi√™n", price: 25000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      { id: 85, name: "C√° vi√™n chi√™n s·ªët cay", price: 30000, category: "ƒê·ªí ƒÇN V·∫∂T", hasSize: false },
      
      // M·ª≤ CAY (5 m√≥n)
      { id: 86, name: "M·ª≥ cay x√∫c x√≠ch", price: 40000, category: "M·ª≤ CAY", hasSize: false },
      { id: 87, name: "M·ª≥ cay b√≤", price: 45000, category: "M·ª≤ CAY", hasSize: false },
      { id: 88, name: "M·ª≥ cay s∆∞·ªùn s·ª•n", price: 45000, category: "M·ª≤ CAY", hasSize: false },
      { id: 89, name: "M·ª≥ cay h·∫£i s·∫£n", price: 50000, category: "M·ª≤ CAY", hasSize: false },
      { id: 90, name: "M·ª≥ cay th·∫≠p c·∫©m", price: 55000, category: "M·ª≤ CAY", hasSize: false },
      
      // B√öN ƒê·∫¨U (5 m√≥n)
      { id: 91, name: "B√∫n ƒë·∫≠u ƒë·∫ßy ƒë·ªß", price: 35000, category: "B√öN ƒê·∫¨U", hasSize: false },
      { id: 92, name: "B√∫n ƒë·∫≠u th√™m b√∫n", price: 40000, category: "B√öN ƒê·∫¨U", hasSize: false },
      { id: 93, name: "B√∫n ƒë·∫≠u th√™m ƒë·∫≠u", price: 40000, category: "B√öN ƒê·∫¨U", hasSize: false },
      { id: 94, name: "B√∫n ƒë·∫≠u th√™m ch·∫£ c·ªëm", price: 45000, category: "B√öN ƒê·∫¨U", hasSize: false },
      { id: 95, name: "B√∫n ƒë·∫≠u th√™m d·ªìi s·ª•n", price: 45000, category: "B√öN ƒê·∫¨U", hasSize: false }
    ];

    // =============================================
    // BI·∫æN TO√ÄN C·ª§C
    // =============================================
    let orders = JSON.parse(localStorage.getItem('orders')) || [];
    let cart = [];
    let isLoggedIn = false;
    let currentCategory = "T·∫§T C·∫¢";
    let selectedSizes = {};
    let outOfStockItems = JSON.parse(localStorage.getItem('outOfStockItems')) || [];

    // =============================================
    // KH·ªûI T·∫†O
    // =============================================
    function init() {
      // Load menu t·ª´ localStorage n·∫øu c√≥
      const savedMenu = localStorage.getItem('menuItems');
      if (savedMenu) {
        menuItems = JSON.parse(savedMenu);
      } else {
        localStorage.setItem('menuItems', JSON.stringify(menuItems));
      }
      
      renderCategoryFilter();
      renderMenu();
      renderCart();
      updateOutOfStockDisplay();
      
      // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
      const savedLogin = localStorage.getItem('isLoggedIn');
      if (savedLogin === 'true') {
        isLoggedIn = true;
        showAdminSections();
        loadOrders();
        renderMenuTable();
        renderAdminCategoryFilter();
      }
      updateAuthButtons();
      
      // B·∫Øt ƒë·∫ßu l·∫Øng nghe Telegram
      startTelegramListener();
    }

    // =============================================
    // L·∫ÆNG NGHE TELEGRAM (ADMIN B√ÅO H·∫æT M√ìN)
    // =============================================
    function startTelegramListener() {
      // L·∫Øng nghe tin nh·∫Øn m·ªói 10 gi√¢y
      setInterval(listenToTelegram, 10000);
      
      // L·∫Øng nghe ngay khi kh·ªüi ƒë·ªông
      setTimeout(listenToTelegram, 2000);
    }

    async function listenToTelegram() {
      try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getUpdates?offset=-10`);
        const data = await response.json();
        
        if (data.result && data.result.length > 0) {
          const lastProcessedId = localStorage.getItem('lastProcessedTelegramId') || '0';
          
          for (const msg of data.result) {
            const messageId = msg.message?.message_id;
            const messageText = msg.message?.text || '';
            
            if (messageId <= parseInt(lastProcessedId)) continue;
            
            // X·ª≠ l√Ω tin nh·∫Øn b√°o h·∫øt m√≥n
            if (messageText.toLowerCase().includes('h·∫øt m√≥n') || messageText.toLowerCase().includes('h·∫øt ')) {
              const itemName = messageText.replace(/h·∫øt m√≥n|h·∫øt/gi, '').trim();
              await markItemOutOfStock(itemName);
            }
            
            // X·ª≠ l√Ω tin nh·∫Øn b√°o c√≤n m√≥n
            if (messageText.toLowerCase().includes('c√≤n m√≥n') || messageText.toLowerCase().includes('c√≥ l·∫°i')) {
              const itemName = messageText.replace(/c√≤n m√≥n|c√≥ l·∫°i|c√≤n/gi, '').trim();
              await markItemInStock(itemName);
            }
            
            localStorage.setItem('lastProcessedTelegramId', messageId.toString());
          }
        }
      } catch (error) {
        console.error('L·ªói l·∫Øng nghe Telegram:', error);
      }
    }

    // =============================================
    // X·ª¨ L√ù M√ìN H·∫æT
    // =============================================
    async function markItemOutOfStock(itemName) {
      const menuItem = menuItems.find(item => 
        item.name.toLowerCase().includes(itemName.toLowerCase())
      );
      
      if (menuItem) {
        if (!outOfStockItems.includes(menuItem.name)) {
          outOfStockItems.push(menuItem.name);
          localStorage.setItem('outOfStockItems', JSON.stringify(outOfStockItems));
          
          // C·∫≠p nh·∫≠t giao di·ªán
          updateOutOfStockDisplay();
          renderMenu();
          
          // G·ª≠i ph·∫£n h·ªìi Telegram
          await sendTelegramMessage(`‚úÖ ƒê√£ ghi nh·∫≠n: ${menuItem.name} ƒë√£ h·∫øt h√†ng!`);
          
          // Ki·ªÉm tra v√† x√≥a kh·ªèi gi·ªè h√†ng c·ªßa c√°c kh√°ch ƒëang c√≥
          removeOutOfStockFromCart(menuItem.name);
          
          showNotification(`ƒê√£ c·∫≠p nh·∫≠t: ${menuItem.name} h·∫øt h√†ng`);
        }
      } else {
        await sendTelegramMessage(`‚ùå Kh√¥ng t√¨m th·∫•y m√≥n "${itemName}" trong menu!`);
      }
    }

    async function markItemInStock(itemName) {
      const menuItem = menuItems.find(item => 
        item.name.toLowerCase().includes(itemName.toLowerCase())
      );
      
      if (menuItem) {
        outOfStockItems = outOfStockItems.filter(name => name !== menuItem.name);
        localStorage.setItem('outOfStockItems', JSON.stringify(outOfStockItems));
        
        updateOutOfStockDisplay();
        renderMenu();
        
        await sendTelegramMessage(`‚úÖ ƒê√£ c·∫≠p nh·∫≠t: ${menuItem.name} ƒë√£ c√≥ h√†ng tr·ªü l·∫°i!`);
        showNotification(`ƒê√£ c·∫≠p nh·∫≠t: ${menuItem.name} c√≤n h√†ng`);
      }
    }

    // Ki·ªÉm tra m√≥n h·∫øt trong gi·ªè h√†ng
    function checkOutOfStockInCart() {
      const outOfStockInCart = [];
      
      for (let cartItem of cart) {
        let itemName = cartItem.originalName || cartItem.name;
        if (itemName.includes('(Size')) {
          itemName = itemName.split('(Size')[0].trim();
        }
        
        if (outOfStockItems.includes(itemName)) {
          outOfStockInCart.push({
            name: itemName,
            cartItem: cartItem
          });
        }
      }
      
      return outOfStockInCart;
    }

    // X√≥a m√≥n h·∫øt kh·ªèi gi·ªè h√†ng
    function removeOutOfStockFromCart(itemName) {
      const originalLength = cart.length;
      cart = cart.filter(item => {
        let itemOriginalName = item.originalName || item.name;
        if (itemOriginalName.includes('(Size')) {
          itemOriginalName = itemOriginalName.split('(Size')[0].trim();
        }
        return !outOfStockItems.includes(itemOriginalName);
      });
      
      if (cart.length < originalLength) {
        showNotification(`üîÑ ƒê√£ x√≥a m√≥n h·∫øt kh·ªèi gi·ªè h√†ng`, 'warning');
        renderCart();
      }
    }

    // Hi·ªÉn th·ªã danh s√°ch m√≥n h·∫øt
    function updateOutOfStockDisplay() {
      const container = document.getElementById('outOfStockList');
      if (!container) return;
      
      if (outOfStockItems.length === 0) {
        container.innerHTML = '<div style="color: #28a745;">‚úÖ T·∫•t c·∫£ c√°c m√≥n ƒë·ªÅu c√≤n h√†ng</div>';
        return;
      }
      
      let html = '<div style="color: #dc3545; font-weight: bold;">üìã DANH S√ÅCH M√ìN ƒê√É H·∫æT:</div>';
      outOfStockItems.forEach(item => {
        html += `<div style="margin-left: 10px;">‚ùå ${item}</div>`;
      });
      container.innerHTML = html;
    }

    // G·ª≠i tin nh·∫Øn Telegram
    async function sendTelegramMessage(message) {
      try {
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: message,
            parse_mode: 'HTML'
          })
        });
      } catch (error) {
        console.error('L·ªói g·ª≠i Telegram:', error);
      }
    }

    // =============================================
    // HI·ªÇN TH·ªä MENU
    // =============================================
    function renderCategoryFilter() {
      const filterDiv = document.getElementById('categoryFilter');
      filterDiv.innerHTML = '<button class="category-btn active" onclick="filterByCategory(\'T·∫§T C·∫¢\')">T·∫§T C·∫¢</button>';
      
      const categories = [...new Set(menuItems.map(item => item.category))];
      categories.sort().forEach(cat => {
        filterDiv.innerHTML += `<button class="category-btn" onclick="filterByCategory('${cat}')">${cat}</button>`;
      });
    }

    function filterByCategory(category) {
      currentCategory = category;
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent === category || (category === 'T·∫§T C·∫¢' && btn.textContent === 'T·∫§T C·∫¢')) {
          btn.classList.add('active');
        }
      });
      renderMenu();
    }

    function renderMenu() {
      const menuGrid = document.getElementById('menuGrid');
      menuGrid.innerHTML = '';
      
      let filtered = menuItems;
      if (currentCategory !== 'T·∫§T C·∫¢') {
        filtered = menuItems.filter(item => item.category === currentCategory);
      }
      
      filtered.forEach(item => {
        const isOutOfStock = outOfStockItems.includes(item.name);
        const itemDiv = document.createElement('div');
        itemDiv.className = `menu-item ${isOutOfStock ? 'out-of-stock' : ''}`;
        
        if (item.hasSize) {
          const sizeKey = `size_${item.id}`;
          if (!selectedSizes[sizeKey]) selectedSizes[sizeKey] = 'S';
          
          itemDiv.innerHTML = `
            <div class="menu-item-name">${item.name}</div>
            ${isOutOfStock ? '<div class="out-of-stock-tag">‚ùå T·∫†M H·∫æT</div>' : ''}
            <div class="menu-item-price">
              <span class="price-small">S: ${item.priceS.toLocaleString()}ƒë</span>
              <span class="price-large">L: ${item.priceL.toLocaleString()}ƒë</span>
            </div>
            <div class="size-selector">
              <button class="size-btn ${selectedSizes[sizeKey] === 'S' ? 'small-active' : ''}" onclick="selectSize(${item.id}, 'S', event)" ${isOutOfStock ? 'disabled' : ''}>Size S</button>
              <button class="size-btn ${selectedSizes[sizeKey] === 'L' ? 'large-active' : ''}" onclick="selectSize(${item.id}, 'L', event)" ${isOutOfStock ? 'disabled' : ''}>Size L</button>
            </div>
            <button class="add-to-cart-btn" onclick="addToCartWithSize(${item.id}, '${item.name.replace(/'/g, "\\'")}', ${item.priceS}, ${item.priceL}, '${selectedSizes[sizeKey]}')" ${isOutOfStock ? 'disabled' : ''}>
              <i class="fas fa-cart-plus"></i> ${isOutOfStock ? 'T·∫°m h·∫øt' : 'Th√™m'}
            </button>
          `;
        } else {
          itemDiv.innerHTML = `
            <div class="menu-item-name">${item.name}</div>
            ${isOutOfStock ? '<div class="out-of-stock-tag">‚ùå T·∫†M H·∫æT</div>' : ''}
            <div class="menu-item-price">
              <span class="price-single">${item.price.toLocaleString()}ƒë</span>
            </div>
            <button class="add-to-cart-btn" onclick="addToCart(${item.id}, '${item.name.replace(/'/g, "\\'")}', ${item.price})" ${isOutOfStock ? 'disabled' : ''}>
              <i class="fas fa-cart-plus"></i> ${isOutOfStock ? 'T·∫°m h·∫øt' : 'Th√™m'}
            </button>
          `;
        }
        
        menuGrid.appendChild(itemDiv);
      });
    }

    function selectSize(itemId, size, event) {
      event.stopPropagation();
      const sizeKey = `size_${itemId}`;
      selectedSizes[sizeKey] = size;
      renderMenu();
    }

    // =============================================
    // GI·ªé H√ÄNG
    // =============================================
    function addToCartWithSize(id, name, priceS, priceL, size) {
      // Ki·ªÉm tra m√≥n c√≤n kh√¥ng
      if (outOfStockItems.includes(name)) {
        showNotification('‚ùå M√≥n n√†y ƒë√£ h·∫øt!', true);
        return;
      }
      
      const price = size === 'S' ? priceS : priceL;
      const itemName = `${name} (Size ${size})`;
      
      const existing = cart.find(item => item.id === id && item.size === size);
      if (existing) {
        existing.qty++;
      } else {
        cart.push({ id, name: itemName, originalName: name, price, qty: 1, size });
      }
      renderCart();
      showNotification(`ƒê√£ th√™m ${name} size ${size}`);
    }

    function addToCart(id, name, price) {
      // Ki·ªÉm tra m√≥n c√≤n kh√¥ng
      if (outOfStockItems.includes(name)) {
        showNotification('‚ùå M√≥n n√†y ƒë√£ h·∫øt!', true);
        return;
      }
      
      const existing = cart.find(item => item.id === id && !item.size);
      if (existing) {
        existing.qty++;
      } else {
        cart.push({ id, name, price, qty: 1 });
      }
      renderCart();
      showNotification(`ƒê√£ th√™m ${name}`);
    }

    function renderCart() {
      const tbody = document.getElementById('cartBody');
      tbody.innerHTML = '';
      let total = 0;
      
      if (cart.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-state">Gi·ªè h√†ng tr·ªëng</td></tr>';
        document.getElementById('subtotal').textContent = '0ƒë';
        document.getElementById('cartTotal').textContent = '0ƒë';
        return;
      }
      
      cart.forEach((item, index) => {
        const itemTotal = item.price * item.qty;
        total += itemTotal;
        
        // Ki·ªÉm tra m√≥n c√≥ b·ªã h·∫øt kh√¥ng
        let itemOriginalName = item.originalName || item.name;
        if (itemOriginalName.includes('(Size')) {
          itemOriginalName = itemOriginalName.split('(Size')[0].trim();
        }
        const isOutOfStock = outOfStockItems.includes(itemOriginalName);
        
        let sizeBadge = '';
        if (item.size) {
          sizeBadge = `<span class="size-badge ${item.size === 'S' ? 'size-s-badge' : 'size-l-badge'}">${item.size}</span>`;
        }
        
        const rowClass = isOutOfStock ? 'out-of-stock-row' : '';
        
        tbody.innerHTML += `
          <tr class="${rowClass}">
            <td>${item.name} ${sizeBadge} ${isOutOfStock ? '<span class="warning-text">(ƒê√£ h·∫øt)</span>' : ''}</td>
            <td>
              <button onclick="updateCartQty(${index}, -1)">-</button>
              ${item.qty}
              <button onclick="updateCartQty(${index}, 1)">+</button>
            </td>
            <td>${item.price.toLocaleString()}ƒë</td>
            <td>${itemTotal.toLocaleString()}ƒë</td>
            <td><button onclick="removeFromCart(${index})" style="background: #dc3545;">X</button></td>
          </tr>
        `;
      });
      
      document.getElementById('subtotal').textContent = total.toLocaleString() + 'ƒë';
      document.getElementById('cartTotal').textContent = total.toLocaleString() + 'ƒë';
    }

    function updateCartQty(index, delta) {
      if (cart[index].qty + delta < 1) {
        removeFromCart(index);
      } else {
        cart[index].qty += delta;
        renderCart();
      }
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      renderCart();
    }

    // =============================================
    // X√ÅC NH·∫¨N ƒê∆†N H√ÄNG (KI·ªÇM TRA M√ìN H·∫æT)
    // =============================================
    function showConfirmModal() {
      if (cart.length === 0) {
        showNotification('Gi·ªè h√†ng tr·ªëng!', true);
        return;
      }
      
      const phone = document.getElementById('customerPhone').value.trim();
      const address = document.getElementById('customerAddress').value.trim();
      
      if (!phone) {
        showNotification('Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i!', true);
        document.getElementById('customerPhone').focus();
        return;
      }
      
      if (!address) {
        showNotification('Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ!', true);
        document.getElementById('customerAddress').focus();
        return;
      }
      
      const phoneRegex = /(84|0[3|5|7|8|9])+([0-9]{8})\b/;
      if (!phoneRegex.test(phone)) {
        showNotification('S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá!', true);
        return;
      }
      
      // KI·ªÇM TRA M√ìN H·∫æT TRONG GI·ªé H√ÄNG
      const outOfStockInCart = checkOutOfStockInCart();
      
      if (outOfStockInCart.length > 0) {
        // Hi·ªÉn th·ªã modal th√¥ng b√°o m√≥n h·∫øt
        let html = '';
        outOfStockInCart.forEach(item => {
          html += `<div style="color: #dc3545; margin: 5px 0;">‚ùå ${item.name}</div>`;
        });
        document.getElementById('outOfStockListModal').innerHTML = html;
        document.getElementById('outOfStockModal').style.display = 'flex';
        
        // X√≥a m√≥n h·∫øt kh·ªèi gi·ªè
        outOfStockInCart.forEach(item => {
          const index = cart.findIndex(c => (c.originalName || c.name).includes(item.name));
          if (index !== -1) removeFromCart(index);
        });
        return;
      }
      
      // N·∫øu kh√¥ng c√≥ m√≥n h·∫øt, hi·ªÉn th·ªã modal x√°c nh·∫≠n
      document.getElementById('confirmPhone').textContent = phone;
      document.getElementById('confirmAddress').textContent = address;
      document.getElementById('confirmNote').textContent = document.getElementById('orderNote').value || 'Kh√¥ng c√≥';
      
      const itemsDiv = document.getElementById('confirmItems');
      itemsDiv.innerHTML = '';
      
      let total = 0;
      cart.forEach(item => {
        const itemTotal = item.price * item.qty;
        total += itemTotal;
        itemsDiv.innerHTML += `
          <div class="confirm-item">
            <span>${item.name} x${item.qty}</span>
            <span>${itemTotal.toLocaleString()}ƒë</span>
          </div>
        `;
      });
      
      document.getElementById('confirmTotal').textContent = `T·ªïng c·ªông: ${total.toLocaleString()}ƒë`;
      document.getElementById('confirmModal').style.display = 'flex';
    }

    function closeConfirmModal() {
      document.getElementById('confirmModal').style.display = 'none';
    }

    function closeOutOfStockModal() {
      document.getElementById('outOfStockModal').style.display = 'none';
    }

    // =============================================
    // T·∫†O ƒê∆†N H√ÄNG
    // =============================================
    async function createOrder() {
      closeConfirmModal();
      
      // Ki·ªÉm tra l·∫°i m√≥n h·∫øt l·∫ßn cu·ªëi
      const outOfStockInCart = checkOutOfStockInCart();
      if (outOfStockInCart.length > 0) {
        showNotification('ƒê∆°n h√†ng c√≥ m√≥n ƒë√£ h·∫øt, vui l√≤ng ki·ªÉm tra l·∫°i!', true);
        return;
      }
      
      const phone = document.getElementById('customerPhone').value.trim();
      const address = document.getElementById('customerAddress').value.trim();
      const note = document.getElementById('orderNote').value;
      const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
      const now = new Date();
      
      const order = {
        id: Date.now(),
        items: cart.map(item => ({
          name: item.name,
          originalName: item.originalName || item.name,
          size: item.size || 'M',
          price: item.price,
          qty: item.qty
        })),
        customer: { phone, address },
        note,
        total,
        time: now.toLocaleString('vi-VN'),
        date: now.toISOString().split('T')[0],
        status: 'new'
      };
      
      // G·ª≠i Telegram
      let message = `<b>‚òï BII COFFEE - ƒê∆†N H√ÄNG M·ªöI #${order.id}</b>\n\n`;
      message += `üïí <b>Th·ªùi gian:</b> ${order.time}\n`;
      message += `üìû <b>SƒêT:</b> ${order.customer.phone}\n`;
      message += `üè† <b>ƒê·ªãa ch·ªâ:</b> ${order.customer.address}\n`;
      message += `üìù <b>Ghi ch√∫:</b> ${note || 'Kh√¥ng c√≥'}\n\n`;
      message += `<b>CHI TI·∫æT M√ìN:</b>\n`;
      order.items.forEach(item => {
        message += `${item.name} x${item.qty} - ${(item.price * item.qty).toLocaleString()}ƒë\n`;
      });
      message += `\n<b>üí∞ T·ªîNG C·ªòNG: ${total.toLocaleString()}ƒë</b>\n`;
      message += `\nüíù <b>C·∫£m ∆°n qu√Ω kh√°ch!</b>`;
      
      try {
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: message,
            parse_mode: 'HTML'
          })
        });
        
        showNotification(`ƒê·∫∑t h√†ng th√†nh c√¥ng! M√£ ƒë∆°n: #${order.id}`);
      } catch (error) {
        showNotification('ƒê√£ t·∫°o ƒë∆°n nh∆∞ng kh√¥ng g·ª≠i ƒë∆∞·ª£c Telegram', true);
      }
      
      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));
      
      cart = [];
      document.getElementById('customerPhone').value = '';
      document.getElementById('customerAddress').value = '';
      document.getElementById('orderNote').value = '';
      renderCart();
      
      if (isLoggedIn) {
        loadOrders();
        renderStats();
      }
    }

    // =============================================
    // ƒêƒÇNG NH·∫¨P / ƒêƒÇNG XU·∫§T
    // =============================================
    function showLoginModal() {
      document.getElementById('loginModal').style.display = 'flex';
      document.getElementById('adminPassword').focus();
    }

    function closeLoginModal() {
      document.getElementById('loginModal').style.display = 'none';
      document.getElementById('adminPassword').value = '';
    }

    function checkLogin() {
      const password = document.getElementById('adminPassword').value;
      if (password === ADMIN_PASSWORD) {
        isLoggedIn = true;
        localStorage.setItem('isLoggedIn', 'true');
        showAdminSections();
        closeLoginModal();
        loadOrders();
        renderStats();
        showNotification('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
      } else {
        showNotification('Sai m·∫≠t kh·∫©u!', true);
      }
    }

    function logout() {
      isLoggedIn = false;
      localStorage.setItem('isLoggedIn', 'false');
      hideAdminSections();
      showNotification('ƒê√£ ƒëƒÉng xu·∫•t');
    }

    function showAdminSections() {
      document.querySelectorAll('.admin-only').forEach(el => el.classList.add('visible'));
      document.getElementById('loginBtn').style.display = 'none';
      document.getElementById('logoutBtn').style.display = 'block';
      renderMenuTable();
      renderAdminCategoryFilter();
      updateOutOfStockDisplay();
    }

    function hideAdminSections() {
      document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('visible'));
      document.getElementById('loginBtn').style.display = 'block';
      document.getElementById('logoutBtn').style.display = 'none';
    }

    function updateAuthButtons() {
      if (isLoggedIn) {
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'block';
      } else {
        document.getElementById('loginBtn').style.display = 'block';
        document.getElementById('logoutBtn').style.display = 'none';
      }
    }

    // =============================================
    // QU·∫¢N L√ù MENU (ADMIN)
    // =============================================
    function renderAdminCategoryFilter() {
      const filterDiv = document.getElementById('adminCategoryFilter');
      if (!filterDiv) return;
      
      filterDiv.innerHTML = '<button class="category-btn active" onclick="filterAdminCategory(\'T·∫§T C·∫¢\')">T·∫§T C·∫¢</button>';
      
      const categories = [...new Set(menuItems.map(item => item.category))];
      categories.sort().forEach(cat => {
        filterDiv.innerHTML += `<button class="category-btn" onclick="filterAdminCategory('${cat}')">${cat}</button>`;
      });
    }

    function filterAdminCategory(category) {
      document.querySelectorAll('#adminCategoryFilter .category-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent === category || (category === 'T·∫§T C·∫¢' && btn.textContent === 'T·∫§T C·∫¢')) {
          btn.classList.add('active');
        }
      });
      renderMenuTable(category);
    }

    function renderMenuTable(category = 'T·∫§T C·∫¢') {
      const tbody = document.getElementById('menuTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      let filtered = menuItems;
      if (category !== 'T·∫§T C·∫¢') {
        filtered = menuItems.filter(item => item.category === category);
      }
      
      filtered.forEach((item, index) => {
        const originalIndex = menuItems.findIndex(m => m.id === item.id);
        const priceS = item.hasSize ? item.priceS : item.price;
        const priceL = item.hasSize ? item.priceL : '';
        const isOutOfStock = outOfStockItems.includes(item.name);
        const stockStatus = isOutOfStock ? '‚ùå H·∫øt' : '‚úÖ C√≤n';
        const stockButton = isOutOfStock 
          ? `<button onclick="markItemInStockFromAdmin('${item.name}')" style="background: #28a745;">B√°o c√≤n</button>`
          : `<button onclick="markItemOutOfStockFromAdmin('${item.name}')" style="background: #dc3545;">B√°o h·∫øt</button>`;
        
        tbody.innerHTML += `
          <tr>
            <td>${item.name}</td>
            <td>${item.category}</td>
            <td>${priceS.toLocaleString()}ƒë</td>
            <td>${priceL ? priceL.toLocaleString() + 'ƒë' : '-'}</td>
            <td style="color: ${isOutOfStock ? '#dc3545' : '#28a745'}; font-weight: bold;">${stockStatus}</td>
            <td>
              <button onclick="editMenuItem(${originalIndex})" style="background: #ffc107;">S·ª≠a</button>
              ${stockButton}
              <button onclick="deleteMenuItem(${originalIndex})" style="background: #dc3545;">X√≥a</button>
            </td>
          </tr>
        `;
      });
    }

    async function markItemOutOfStockFromAdmin(itemName) {
      await markItemOutOfStock(itemName);
      renderMenuTable();
    }

    async function markItemInStockFromAdmin(itemName) {
      await markItemInStock(itemName);
      renderMenuTable();
    }

    function addMenuItem() {
      const name = document.getElementById('menuName').value.trim();
      const priceS = parseInt(document.getElementById('menuPriceS').value);
      const priceL = parseInt(document.getElementById('menuPriceL').value);
      const category = document.getElementById('menuCategory').value;
      
      if (!name || isNaN(priceS) || priceS <= 0) {
        showNotification('Nh·∫≠p t√™n m√≥n v√† gi√° S!', true);
        return;
      }
      
      const newId = Math.max(...menuItems.map(m => m.id)) + 1;
      
      if (!isNaN(priceL) && priceL > 0) {
        menuItems.push({ id: newId, name, priceS, priceL, category, hasSize: true });
      } else {
        menuItems.push({ id: newId, name, price: priceS, category, hasSize: false });
      }
      
      localStorage.setItem('menuItems', JSON.stringify(menuItems));
      
      renderCategoryFilter();
      renderMenu();
      renderMenuTable();
      renderAdminCategoryFilter();
      
      document.getElementById('menuName').value = '';
      document.getElementById('menuPriceS').value = '';
      document.getElementById('menuPriceL').value = '';
      
      showNotification('ƒê√£ th√™m m√≥n!');
    }

    function editMenuItem(index) {
      const item = menuItems[index];
      document.getElementById('menuName').value = item.name;
      document.getElementById('menuPriceS').value = item.hasSize ? item.priceS : item.price;
      document.getElementById('menuPriceL').value = item.hasSize ? item.priceL : '';
      document.getElementById('menuCategory').value = item.category;
      
      menuItems.splice(index, 1);
      localStorage.setItem('menuItems', JSON.stringify(menuItems));
      
      renderCategoryFilter();
      renderMenu();
      renderMenuTable();
      renderAdminCategoryFilter();
      
      showNotification('ƒê√£ chuy·ªÉn sang ch·∫ø ƒë·ªô s·ª≠a, h√£y nh·∫≠p th√¥ng tin v√† th√™m m·ªõi!');
    }

    function deleteMenuItem(index) {
      if (confirm('X√≥a m√≥n n√†y?')) {
        menuItems.splice(index, 1);
        localStorage.setItem('menuItems', JSON.stringify(menuItems));
        
        renderCategoryFilter();
        renderMenu();
        renderMenuTable();
        renderAdminCategoryFilter();
        
        showNotification('ƒê√£ x√≥a m√≥n!');
      }
    }

    // =============================================
    // QU·∫¢N L√ù ƒê∆†N H√ÄNG (ADMIN)
    // =============================================
    function loadOrders() {
      orders = JSON.parse(localStorage.getItem('orders')) || [];
      renderOrders();
      renderStats();
    }

    function renderOrders() {
      const searchTerm = document.getElementById('searchOrders')?.value.toLowerCase() || '';
      const statusFilter = document.getElementById('orderStatus')?.value || 'all';
      
      let filtered = orders;
      
      if (searchTerm) {
        filtered = filtered.filter(o => 
          o.customer?.phone?.includes(searchTerm) ||
          o.customer?.address?.toLowerCase().includes(searchTerm) ||
          o.items.some(i => i.name.toLowerCase().includes(searchTerm))
        );
      }
      
      if (statusFilter !== 'all') {
        filtered = filtered.filter(o => o.status === statusFilter);
      }
      
      filtered.sort((a, b) => b.id - a.id);
      
      const ordersList = document.getElementById('ordersList');
      ordersList.innerHTML = '';
      
      if (filtered.length === 0) {
        ordersList.innerHTML = '<p class="empty-state">Kh√¥ng c√≥ ƒë∆°n h√†ng</p>';
        return;
      }
      
      filtered.forEach(order => {
        const statusClass = order.status === 'new' ? 'status-new' : (order.status === 'processing' ? 'status-processing' : 'status-completed');
        const statusText = order.status === 'new' ? 'M·ªõi' : (order.status === 'processing' ? 'ƒêang x·ª≠ l√Ω' : 'Ho√†n th√†nh');
        
        ordersList.innerHTML += `
          <div class="order-card">
            <div class="order-header">
              <strong>#${order.id}</strong>
              <span class="order-status ${statusClass}">${statusText}</span>
            </div>
            <div><i class="fas fa-phone"></i> ${order.customer?.phone}</div>
            <div><i class="fas fa-map-marker-alt"></i> ${order.customer?.address}</div>
            <div><i class="fas fa-clock"></i> ${order.time}</div>
            <div><i class="fas fa-coffee"></i> ${order.items.map(i => `${i.name} x${i.qty}`).join(', ')}</div>
            <div style="font-weight: bold; color: var(--primary); margin: 10px 0;">T·ªïng: ${order.total.toLocaleString()}ƒë</div>
            <div class="order-actions">
              <button onclick="viewOrderDetail(${order.id})" style="background: #17a2b8;">Chi ti·∫øt</button>
              <button onclick="updateOrderStatus(${order.id}, 'processing')" style="background: #ffc107;">ƒêang x·ª≠ l√Ω</button>
              <button onclick="updateOrderStatus(${order.id}, 'completed')" style="background: #28a745;">Ho√†n th√†nh</button>
              <button onclick="deleteOrder(${order.id})" style="background: #dc3545;">X√≥a</button>
            </div>
          </div>
        `;
      });
    }

    function renderStats() {
      const dateInput = document.getElementById('statsDate').value;
      let filtered = orders;
      
      if (dateInput) {
        filtered = orders.filter(o => o.date === dateInput);
      }
      
      const totalOrders = filtered.length;
      const revenue = filtered.reduce((s, o) => s + o.total, 0);
      const highest = filtered.length ? Math.max(...filtered.map(o => o.total)) : 0;
      
      const itemCount = {};
      filtered.forEach(o => o.items.forEach(i => {
        itemCount[i.originalName || i.name] = (itemCount[i.originalName || i.name] || 0) + i.qty;
      }));
      const topItem = Object.entries(itemCount).sort((a,b) => b[1] - a[1])[0];
      
      document.getElementById('totalOrders').textContent = totalOrders;
      document.getElementById('totalRevenue').textContent = revenue.toLocaleString() + 'ƒë';
      document.getElementById('highestOrder').textContent = highest.toLocaleString() + 'ƒë';
      document.getElementById('bestSeller').textContent = topItem ? `${topItem[0]} (${topItem[1]})` : '-';
      
      const recent = filtered.slice(-5).reverse();
      let recentHtml = '<h3>ƒê∆°n h√†ng g·∫ßn ƒë√¢y</h3><table style="width:100%"><tr><th>M√£</th><th>SƒêT</th><th>Ti·ªÅn</th></tr>';
      recent.forEach(o => {
        recentHtml += `<tr><td>#${o.id}</td><td>${o.customer?.phone}</td><td>${o.total.toLocaleString()}ƒë</td></tr>`;
      });
      recentHtml += '</table>';
      document.getElementById('recentOrders').innerHTML = recentHtml;
    }

    function showTodayStats() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('statsDate').value = today;
      renderStats();
    }

    function showAllStats() {
      document.getElementById('statsDate').value = '';
      renderStats();
    }

    function viewOrderDetail(id) {
      const order = orders.find(o => o.id === id);
      if (!order) return;
      
      const modal = document.getElementById('orderDetailModal');
      const content = document.getElementById('orderDetailContent');
      
      let itemsHtml = '';
      order.items.forEach(item => {
        itemsHtml += `<tr><td>${item.name}</td><td>${item.qty}</td><td>${item.price.toLocaleString()}ƒë</td><td>${(item.price * item.qty).toLocaleString()}ƒë</td></tr>`;
      });
      
      content.innerHTML = `
        <h2>ƒê∆°n h√†ng #${order.id}</h2>
        <p><strong>Th·ªùi gian:</strong> ${order.time}</p>
        <p><strong>SƒêT:</strong> ${order.customer?.phone}</p>
        <p><strong>ƒê·ªãa ch·ªâ:</strong> ${order.customer?.address}</p>
        <p><strong>Ghi ch√∫:</strong> ${order.note || 'Kh√¥ng c√≥'}</p>
        <p><strong>Tr·∫°ng th√°i:</strong> ${order.status}</p>
        
        <h3>M√≥n ƒë√£ g·ªçi</h3>
        <table style="width:100%">
          <tr><th>M√≥n</th><th>SL</th><th>ƒê∆°n gi√°</th><th>Th√†nh ti·ªÅn</th></tr>
          ${itemsHtml}
        </table>
        
        <p style="text-align:right; font-weight:bold; margin-top:10px;">T·ªïng: ${order.total.toLocaleString()}ƒë</p>
        
        <button onclick="document.getElementById('orderDetailModal').style.display='none'" style="margin-top:10px;">ƒê√≥ng</button>
      `;
      
      modal.style.display = 'flex';
    }

    function closeOrderDetailModal() {
      document.getElementById('orderDetailModal').style.display = 'none';
    }

    function updateOrderStatus(id, status) {
      const order = orders.find(o => o.id === id);
      if (!order) return;
      
      order.status = status;
      localStorage.setItem('orders', JSON.stringify(orders));
      
      loadOrders();
      renderStats();
      showNotification(`ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n #${id}`);
    }

    function deleteOrder(id) {
      if (!confirm(`X√≥a ƒë∆°n h√†ng #${id}?`)) return;
      
      orders = orders.filter(o => o.id !== id);
      localStorage.setItem('orders', JSON.stringify(orders));
      
      loadOrders();
      renderStats();
      showNotification(`ƒê√£ x√≥a ƒë∆°n #${id}`);
    }

    // =============================================
    // TH√îNG B√ÅO
    // =============================================
    function showNotification(message, isError = false) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = 'notification' + (isError ? ' error' : '') + ' show';
      setTimeout(() => notification.classList.remove('show'), 3000);
    }

    // =============================================
    // KH·ªûI CH·∫†Y
    // =============================================
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
